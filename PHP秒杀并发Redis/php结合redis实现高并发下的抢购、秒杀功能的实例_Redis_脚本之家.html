<!DOCTYPE html>
<!-- saved from url=(0038)http://www.jb51.net/article/100050.htm -->
<html lang="zh-CN"><head><meta http-equiv="Content-Type" content="text/html; charset=GBK">

<meta name="applicable-device" content="pc">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="Cache-Control" content="no-siteapp">
<meta http-equiv="Cache-Control" content="no-transform">
<title>php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家</title>
<meta http-equiv="X-UA-Compatible" content="IE=EDGE">
<meta name="keywords" content="php,抢购,并发,redis">
<meta name="description" content="下面小编就为大家带来一篇php结合redis实现高并发下的抢购、秒杀功能的实例。小编觉得挺不错的，现在就分享给大家，也给大家做个参考。一起跟随小编过来看看吧">
<link rel="alternate" media="only screen and(max-width: 640px)" href="http://m.jb51.net/article/100050.htm">
<meta http-equiv="mobile-agent" content="format=html5; url=http://m.jb51.net/article/100050.htm">
<meta http-equiv="mobile-agent" content="format=xhtml; url=http://m.jb51.net/article/100050.htm">
<script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/hm.js"></script><script type="text/javascript" async="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/dynamicFloat.js"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/ca-pub-6384567588307613.js"></script><script type="text/javascript" async="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/pr.js"></script><script type="text/javascript" async="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/zb7e50c7dcf6cefe31964b28dc.js"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/push.js"></script><script type="text/javascript">
var tougao="jingxian";var lmname="Redis";
(function(){var reWriteUrl=function(url){if(url){var Splits=url.split("/"),siteName=window.location.pathname;if(typeof siteName!=="undefined"){return "http://m.jb51.net"+siteName}}};if(/Android|webOS|iPhone|iPad|Windows Phone|iPod|BlackBerry|SymbianOS|Nokia|Mobile/i.test(navigator.userAgent)){var url=window.location.href;var pathname=window.location.pathname;if(url.indexOf("?pc")<0){try{window.location.href=reWriteUrl(url)}catch(e){}}}})();
</script>
<link type="text/css" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/base.css" rel="stylesheet">
<link type="text/css" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/common.css" rel="stylesheet">
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/jquery.min.js"></script>
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/function.js"></script>
<script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/version-v3.js"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/cookie"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/adapter.min.js"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/cyrHH3dwi"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/version.js"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/cookie(1)"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/cyrHH3dwi(1)"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/event"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/sea.v2.2.0.js"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/app-build.js"></script><link rel="stylesheet" type="text/css" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/upload-img.css"><style id="changyanCss">#SOHUCS{clear:both;min-height:320;_height:320px;overflow:visible;}#SOHUCS iframe{width:100%;min-height:320px;_height:320px;}</style><link charset="utf-8" rel="stylesheet" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/changyan2.css"><link charset="utf-8" rel="stylesheet" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/default.css"><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/main.js"></script><script type="text/javascript" charset="UTF-8" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/render-pc.js"></script></head>
<body style=""><div id="BAIDU_DUP_fp_wrapper" style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;"><iframe id="BAIDU_DUP_fp_iframe" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/o.html" style="width: 0px; height: 0px; visibility: hidden; display: none;"></iframe></div>
<!--head Star -->
<div id="head">
  <div class="toolBar">
  <div class="main">
    <!--topNav Star -->
    <div class="topNav clearfix">
      <ul class="navList fl">
        <li>
          <div class="one"><a href="http://www.jb51.net/" target="_blank">脚本之家</a></div>
        </li>
        <li>
          <div class="one"><a href="http://www.jb51.net/softs/" target="_blank">软件下载<i class="icon"></i></a></div>
          <div class="two">
<a href="http://www.jb51.net/softs/android.html" target="_blank">android软件</a> <a href="http://www.jb51.net/softs/mac.html" target="_blank">MAC软件</a> <a href="http://www.jb51.net/qudong/" target="_blank">驱动下载</a> <a href="http://www.jb51.net/fonts/" target="_blank">字体下载</a> <a href="http://www.jb51.net/dll/" target="_blank">DLL下载</a> </div>
</li>
        <li>
          <div class="one"><a href="http://www.jb51.net/codes/" target="_blank">源码下载<i class="icon"></i></a></div>
          <div class="two"> <a href="http://www.jb51.net/codes/asp.html" target="_blank">asp源码</a> <a href="http://www.jb51.net/codes/php.html" target="_blank">php源码</a> <a href="http://www.jb51.net/codes/aspnet.html" target="_blank">asp.net源码</a> <a href="http://www.jb51.net/codes/jsp.html" target="_blank">jsp源码</a> <a href="http://www.jb51.net/codes/editor.html" target="_blank">网页编辑器</a> <a href="http://www.jb51.net/codes/list123_1.html" target="_blank">数据库管理</a> <a href="http://www.jb51.net/codes/list124_1.html" target="_blank">常用组件</a> <a href="http://www.jb51.net/jiaoben/" target="_blank">脚本下载</a></div>
        </li>
        <li class="">
          <div class="one"><a href="http://tools.jb51.net/" target="_blank">在线工具<i class="icon"></i></a></div>
          <div class="two"> <a href="http://www.jb51.net/shouce/" target="_blank">在线手册</a> <a href="http://www.jb51.net/tools/cssyasuo.shtml" target="_blank">CSS格式化</a> <a href="http://tools.jb51.net/code/js" target="_blank">JS格式化</a> <a href="http://www.jb51.net/tools/html-js.htm" target="_blank">Html转化为Js</a> <a href="http://tools.jb51.net/regex/javascript" target="_blank">js正则表达式</a>
</div>
        </li>
        <li>
          <div class="one"><a href="http://www.jb51.net/w3school/" target="_blank">网页教程基础</a></div>
        </li>
			<li>
          <div class="one"><a href="http://s.jb51.net/" target="_blank">服务器常用软件</a></div>
        </li>
		<li>
          <div class="one"><a href="http://m.jb51.net/" target="_blank">手机版</a></div>
          <div class="two"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/m.jb51.net.png" data-baiduimageplus-ignore=""></div>     
        </li>
        <li><div class="one"><a href="http://wxbj.jb51.net/" target="_blank">微信编辑器</a></div></li><li class="watch">
          <div class="one"><a href="http://www.jb51.net/about.htm" target="_blank" rel="nofollow"><i class="icon"></i>关注微信</a></div>
          <div class="two"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/weixin_200.gif" data-baiduimageplus-ignore=""></div>
        </li>
      </ul>
      <div class="navUser mt5 fr" id="jb51_topbar"><div class="userbar"><a href="http://tougao.jb51.net/" target="_blank">投稿中心</a><img style="width:32px; height:22px" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/newn.gif" alt="hot"></div></div>
    </div>
    <!--topNav End -->
  </div>
</div>

  <div class="main clearfix">
    <div class="mtb10 clearfix">
      <div class="logo"><a href="http://www.jb51.net/"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/logo.gif" title="脚本之家" alt="脚本之家"></a></div>
      <div class="logom fl"><a href="http://vps.zzidc.com/tongji/jb51.html" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/zzidc370.gif" width="370" height="60"></a>
</div>
      <div class="logor fr"><a href="http://www.jisuapp.cn/index.php?r=pc/Webapp/AppTpl" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/jisuapp370.jpg" width="370" height="60"></a>
</div>
    </div>
<!-- 导航-->
<div class="nav_top clearfix">
<ul>
<li><a href="http://www.jb51.net/web/">网页制作</a></li>
<li><a href="http://www.jb51.net/list/index_1.htm">网络编程</a></li>
<li><a href="http://www.jb51.net/list/index_96.htm">脚本专栏</a></li>
<li><a href="http://www.jb51.net/jiaoben/">脚本下载</a></li>
<li><a href="http://www.jb51.net/list/index_104.htm">数据库</a></li>
<li><a href="http://www.jb51.net/cms/">CMS教程</a></li>
<li><a href="http://www.jb51.net/books/">电子书籍</a></li>
<li><a href="http://www.jb51.net/pingmian/">平面设计</a></li>
<li><a href="http://www.jb51.net/media/">媒体动画</a></li>
<li><a href="http://www.jb51.net/os/">操作系统</a></li>
<li><a href="http://www.jb51.net/yunying/">网站运营</a></li>
<li><a href="http://www.jb51.net/hack/">网络安全</a></li>
<li class="last"><a href="http://www.jb51.net/shouce/">在线手册</a></li>

</ul>
</div>

<!--导航结束-->
<div class="subnav clearfix">
<ul><li><a href="http://www.jb51.net/list/list_113_1.htm" title="MsSql">MsSql</a></li>
<li><a href="http://www.jb51.net/list/list_112_1.htm" title="Mysql">Mysql</a></li>
<li><a href="http://www.jb51.net/list/list_252_1.htm" title="mariadb">mariadb</a></li>
<li><a href="http://www.jb51.net/list/list_154_1.htm" title="oracle">oracle</a></li>
<li><a href="http://www.jb51.net/list/list_155_1.htm" title="DB2">DB2</a></li>
<li><a href="http://www.jb51.net/list/list_236_1.htm" title="mssql2008">mssql2008</a></li>
<li><a href="http://www.jb51.net/list/list_210_1.htm" title="mssql2005">mssql2005</a></li>
<li><a href="http://www.jb51.net/list/list_215_1.htm" title="SQLite">SQLite</a></li>
<li><a href="http://www.jb51.net/list/list_224_1.htm" title="PostgreSQL">PostgreSQL</a></li>
<li><a href="http://www.jb51.net/list/list_239_1.htm" title="MongoDB">MongoDB</a></li>
<li><a href="http://www.jb51.net/list/list_242_1.htm" title="Redis">Redis</a></li>
<li><a href="http://www.jb51.net/list/list_105_1.htm" title="Access">Access</a></li>
<li><a href="http://www.jb51.net/list/list_132_1.htm" title="数据库文摘">数据库文摘</a></li>
<li><a href="http://www.jb51.net/list/list_133_1.htm" title="数据库其它">数据库其它</a></li>
</ul>
</div>
<div class="NavBar clearfix ptb10">
<div class="fl w690">
<div class="box mb15 mt10"><i class="icon"></i>您的位置：<a href="http://www.jb51.net/">首页</a> → <a href="http://www.jb51.net/list/index_104.htm" title="数据库">数据库</a> → <a href="http://www.jb51.net/list/list_242_1.htm" title="Redis">Redis</a> → 正文内容 php 抢购 并发 redis</div>
</div>
<div class="fr w300"><div class="search">
<form action="http://so.jb51.net/cse/search" target="_blank">
    <input type="hidden" name="s" value="10520733385329581432">
    <input type="hidden" name="ie" value="gbk">
    <input type="text" name="q" class="key_input" placeholder="请输入关键词">
    <input type="submit" value="搜索" class="c_btn">
</form></div></div>
  </div>
</div>
<!--head End -->
<div class="main mb10 clearfix">
<div class="clearfix"><div class="mainlr"><a href="http://click.aliyun.com/m/22821/" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/ali1000.jpg" alt="cdnoss" width="1000" height="60"></a></div><div class="blank5"></div><div id="txtlink"><ul><li><a href="http://www.qqll.me/" target="_blank"><span style="color:red;">低价出售流量10000IP只需8元</span></a></li><li><a href="http://click.aliyun.com/m/15321/" target="_blank"><span style="color:red;">30余款阿里云产品免费6个月&gt;&gt;</span></a></li><li><a href="http://user.liuliangdada.com/" target="_blank"><span style="color:red;">日供百万IP、2亿UV★5元/万、可点击</span></a></li><li><a href="http://www.zoneidc.com/" target="_blank"><span style="color:red;">1G香港云49元/美国云49元/韩国云89元</span></a></li><li><a href="https://s.jb51.net/" target="_blank"><span style="color:blue;">服务器常用软件下载――脚本之家</span></a></li><li><a href="http://www.xmwzidc.com/" target="_blank"><span style="color:blue;">◆◆◆海西数据全球服务器租用◆◆◆</span></a></li><li><a href="http://www.daniu.net/" target="_blank"><span style="color:blue;">★免费虚拟定位软件，安卓苹果都可以用★</span></a></li><li><a href="http://www.zitian.cn/Products/zhongyuan/overview.aspx" target="_blank"><span style="color:blue;">中原地区核心数据中心，首月托管免费</span></a></li><li><a href="http://www.laoyuming.com/" target="_blank"><span style="color:red;">【3000个备案老域名】100元起 每天更新</span></a></li><li><a href="http://www.2016idc.com/cdn.html" target="_blank"><span style="color:red;">◆◆◆◆◆高防免备案CDN◆◆◆◆◆</span></a></li><li><a href="http://www.enkj.com/special/20160315/" target="_blank"><span style="color:red;">BGP四线 亿恩1U服务器托管3999元/年</span></a></li><li><a href="http://www.jjidc.com/" target="_blank"><span style="color:red;">九九数据 ― 工信部认可正规资质IDC接入商</span></a></li><li><a href="http://www.oo.ht/s/?wd=php+jquery" target="_blank"><span style="color:blue;">OO搜索PHP PYTHON JQUERY免费收录网站</span></a></li><li><a href="http://www.ku86.com/" target="_blank"><span style="color:blue;">百兆 12核24线程 16G内存 2T 999/月</span></a></li><li><a href="http://www.021.net/" target="_blank"><span style="color:blue;">众生网络 基于云计算的互联网基础服务运营商</span></a></li><li><a href="http://b.99-idc.com/bohaovps.asp?typeid=3000" target="_blank"><span style="color:blue;">拔号VPS/全国混拔VPS/拔号服务器-创梦网络</span></a></li><li><a href="http://www.33ip.com/" target="_blank"><span style="color:red;">枫信科技-江苏双线10M保证-399/元</span></a></li><li><a href="http://www.gwidc.com/html/server_zy_xz.asp" target="_blank"><span style="color:red;">港湾网络-徐州百独16核32G 999/月~</span></a></li><li><a href="http://www.ssf.cc/" target="_blank"><span style="color:red;">免备vps20/百独799/双线350/45互联</span></a></li><li><a href="http://www.xiaozhiyun.com/2016/" target="_blank"><span style="color:red;">韩国香港美国站群服务器 巨牛网络</span></a></li><li><a href="http://www.139w.com/" target="_blank"><span style="color:blue;">鼎点网络百兆独享服务器仅需999元</span></a></li><li><a href="http://www.360jq.com/hkshuang.htm" target="_blank"><span style="color:blue;">[香港双高防]无视CC★DDOS/堪比广东！</span></a></li><li><a href="http://www.cyidc.cc/" target="_blank"><span style="color:blue;">畅游网络 百独服务器 包跑满 998元</span></a></li><li><a href="http://www.wdw6.com/" target="_blank"><span style="color:blue;">服务器租用  199元起</span></a></li><li><a href="http://www.wsisp.net/sale/20170518/?indexjb" target="_blank"><span style="color:red;">~}5M独享云主机599/年}~</span></a></li><li><a href="http://www.qy.com.cn/" target="_blank"><span style="color:red;">群英云服务器送10M带宽30G防御,49元起</span></a></li><li><a href="http://www.tuidc.com/" target="_blank"><span style="color:red;">服务器租用/托管-域名空间/认准腾佑科技</span></a></li><li><a href="https://www.zllyun.com/" target="_blank"><span style="color:red;">}~香港云虚拟主机￥1/年 }~</span></a></li></ul><div class="clearfix"></div></div><div class="blank6"></div><div class="topimg"><ul><li><a href="http://www.west.cn/services/CloudHost/?ads=jb512014" target="_blank"><img alt="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/west263_237.gif" width="237" height="60"></a></li><li><a href="http://click.aliyun.com/m/21949/" target="_blank"><img alt="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/ali_237_1.jpg" width="237" height="60"></a></li><li><a href="http://www.xinghai365.com/new/cloud/cloud.asp" target="_blank"><img alt="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/xinghaivps.gif" width="237" height="60"></a></li><li><a href="http://www.8dwww.com/product/list/11754.html" target="_blank"><img alt="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/7ehk.gif" width="237" height="60"></a></li></ul></div><div class="blank6"></div><div class="mainlr"><a href="https://cloud.tencent.com/developer/labs?fromSource=gwzcw.267034.267034.267034" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/tengxunyun.gif" alt="mtyun" width="1000" height="60"></a></div><div class="blank5"></div><div class="mainlr"><a href="http://edu.51cto.com/activity/lists/id-50.html?qd=jiao" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/51cto.png" alt="mtyun" width="1000" height="60"></a></div><div class="blank5"></div>
</div>
</div>

<!--content Star -->
<div id="contents">
 <div class="main clearfix">
      <div class="w690 fl">
      <div class="article-content border">
      <div class="title">
            <h1 class="YaHei">php结合redis实现高并发下的抢购、秒杀功能的实例</h1>
            <p>投稿：jingxian  字体：[<a href="javascript:turnbig()">增加</a> <a href="javascript:turnsmall()">减小</a>] 类型：转载 时间：2016-12-14<a href="http://www.jb51.net/article/100050.htm#comments"> 我要评论</a></p>
        </div>
        <div class="art_desc mt10"><div id="art_demo">下面小编就为大家带来一篇php结合redis实现高并发下的抢购、秒杀功能的实例。小编觉得挺不错的，现在就分享给大家，也给大家做个参考。一起跟随小编过来看看吧</div></div>
        <div class="lbd clearfix"><div id="_bt3eu7dmgvq85zqeudviy66r" style="width: 100%;"><div style="display:none"></div><iframe width="680" frameborder="0" height="100" scrolling="no" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/s.html"></iframe><div style="display:none"></div></div><script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/gn3a1ecf96f1ccff30db1c7481b2b03ded00b3930a3ef6.js"></script>
</div>
        <div id="content">
<p>抢购、秒杀是如今很常见的一个应用场景，主要需要解决的问题有两个：</p>
<p><span style="color: #ff0000"><strong>1 高并发对数据库产生的压力</strong></span></p>
<p><span style="color: #ff0000"><strong>2 竞争状态下如何解决库存的正确减少（"超卖"问题）</strong></span></p>
<p>对于第一个问题，已经很容易想到用缓存来处理抢购，避免直接操作数据库，例如使用Redis。</p>
<p>重点在于第二个问题</p>
<p><span style="color: #ff00ff"><strong>常规写法：</strong></span></p>
<p>查询出对应商品的库存，看是否大于0，然后执行生成订单等操作，但是在判断库存是否大于0处，如果在高并发下就会有问题，导致库存量出现负数</p>
<div class="jb51code">
<div><div id="highlighter_529422" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$conn</code><code class="php plain">=mysql_connect(</code><code class="php string">"localhost"</code><code class="php plain">,</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php string">"123456"</code><code class="php plain">); </code></div><div class="line number3 index2 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php variable">$conn</code><code class="php plain">){ </code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"connect failed"</code><code class="php plain">; </code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">exit</code><code class="php plain">; </code></div><div class="line number6 index5 alt1"><code class="php plain">} </code></div><div class="line number7 index6 alt2"><code class="php plain">mysql_select_db(</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number8 index7 alt1"><code class="php plain">mysql_query(</code><code class="php string">"set names utf8"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php variable">$price</code><code class="php plain">=10;</code></div><div class="line number11 index10 alt2"><code class="php variable">$user_id</code><code class="php plain">=1;</code></div><div class="line number12 index11 alt1"><code class="php variable">$goods_id</code><code class="php plain">=1;</code></div><div class="line number13 index12 alt2"><code class="php variable">$sku_id</code><code class="php plain">=11;</code></div><div class="line number14 index13 alt1"><code class="php variable">$number</code><code class="php plain">=1;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="php comments">//生成唯一订单</code></div><div class="line number17 index16 alt2"><code class="php keyword">function</code> <code class="php plain">build_order_no(){</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php functions">date</code><code class="php plain">(</code><code class="php string">'ymd'</code><code class="php plain">).</code><code class="php functions">substr</code><code class="php plain">(implode(NULL, </code><code class="php functions">array_map</code><code class="php plain">(</code><code class="php string">'ord'</code><code class="php plain">, </code><code class="php functions">str_split</code><code class="php plain">(</code><code class="php functions">substr</code><code class="php plain">(uniqid(), 7, 13), 1))), 0, 8);</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php comments">//记录日志</code></div><div class="line number21 index20 alt2"><code class="php keyword">function</code> <code class="php plain">insertLog(</code><code class="php variable">$event</code><code class="php plain">,</code><code class="php variable">$type</code><code class="php plain">=0){</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$conn</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_log(event,type) </code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$event'</code><code class="php plain">,</code><code class="php string">'$type'</code><code class="php plain">)"; </code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number26 index25 alt1"><code class="php plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php comments">//模拟下单操作</code></div><div class="line number29 index28 alt2"><code class="php comments">//库存是否大于0</code></div><div class="line number30 index29 alt1"><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"select number from ih_store where goods_id='$goods_id' and sku_id='$sku_id'"</code><code class="php plain">;</code><code class="php comments">//解锁 此时ih_store数据中goods_id='$goods_id' and sku_id='$sku_id' 的数据被锁住(注3)，其它事务必须等待此次事务 提交后才能执行</code></div><div class="line number31 index30 alt2"><code class="php variable">$rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">);</code></div><div class="line number32 index31 alt1"><code class="php variable">$row</code><code class="php plain">=mysql_fetch_assoc(</code><code class="php variable">$rs</code><code class="php plain">);</code></div><div class="line number33 index32 alt2"><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$row</code><code class="php plain">[</code><code class="php string">'number'</code><code class="php plain">]&gt;0){</code><code class="php comments">//高并发下会导致超卖</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_sn</code><code class="php plain">=build_order_no();</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//生成订单 </code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_order(order_sn,user_id,goods_id,sku_id,price) </code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$order_sn'</code><code class="php plain">,</code><code class="php string">'$user_id'</code><code class="php plain">,</code><code class="php string">'$goods_id'</code><code class="php plain">,</code><code class="php string">'$sku_id'</code><code class="php plain">,</code><code class="php string">'$price'</code><code class="php plain">)"; </code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//库存减少</code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"update ih_store set number=number-{$number} where sku_id='$sku_id'"</code><code class="php plain">;</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$store_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(mysql_affected_rows()){ </code></div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少成功'</code><code class="php plain">);</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{ </code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少失败'</code><code class="php plain">);</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code></div><div class="line number48 index47 alt1"><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存不够'</code><code class="php plain">);</code></div><div class="line number50 index49 alt1"><code class="php plain">}</code></div><div class="line number51 index50 alt2"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff0000"><strong>优化方案1：</strong></span>将库存字段number字段设为unsigned，当库存为0时，因为字段不能为负数，将会返回false</p>
<p>&nbsp;</p>
<div class="jb51code">
<div><div id="highlighter_947701" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php comments">//库存减少</code></div><div class="line number2 index1 alt1"><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"update ih_store set number=number-{$number} where sku_id='$sku_id' and number&gt;0"</code><code class="php plain">;</code></div><div class="line number3 index2 alt2"><code class="php variable">$store_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number4 index3 alt1"><code class="php keyword">if</code><code class="php plain">(mysql_affected_rows()){ </code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少成功'</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff0000"><strong>优化方案2：</strong></span>使用<span style="color: #ff00ff"><strong>MySQL</strong></span>的事务，锁住操作的行</p>
<div class="jb51code">
<div><div id="highlighter_119532" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$conn</code><code class="php plain">=mysql_connect(</code><code class="php string">"localhost"</code><code class="php plain">,</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php string">"123456"</code><code class="php plain">); </code></div><div class="line number3 index2 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php variable">$conn</code><code class="php plain">){ </code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"connect failed"</code><code class="php plain">; </code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">exit</code><code class="php plain">; </code></div><div class="line number6 index5 alt1"><code class="php plain">} </code></div><div class="line number7 index6 alt2"><code class="php plain">mysql_select_db(</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number8 index7 alt1"><code class="php plain">mysql_query(</code><code class="php string">"set names utf8"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php variable">$price</code><code class="php plain">=10;</code></div><div class="line number11 index10 alt2"><code class="php variable">$user_id</code><code class="php plain">=1;</code></div><div class="line number12 index11 alt1"><code class="php variable">$goods_id</code><code class="php plain">=1;</code></div><div class="line number13 index12 alt2"><code class="php variable">$sku_id</code><code class="php plain">=11;</code></div><div class="line number14 index13 alt1"><code class="php variable">$number</code><code class="php plain">=1;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="php comments">//生成唯一订单号</code></div><div class="line number17 index16 alt2"><code class="php keyword">function</code> <code class="php plain">build_order_no(){</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php functions">date</code><code class="php plain">(</code><code class="php string">'ymd'</code><code class="php plain">).</code><code class="php functions">substr</code><code class="php plain">(implode(NULL, </code><code class="php functions">array_map</code><code class="php plain">(</code><code class="php string">'ord'</code><code class="php plain">, </code><code class="php functions">str_split</code><code class="php plain">(</code><code class="php functions">substr</code><code class="php plain">(uniqid(), 7, 13), 1))), 0, 8);</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php comments">//记录日志</code></div><div class="line number21 index20 alt2"><code class="php keyword">function</code> <code class="php plain">insertLog(</code><code class="php variable">$event</code><code class="php plain">,</code><code class="php variable">$type</code><code class="php plain">=0){</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$conn</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_log(event,type) </code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$event'</code><code class="php plain">,</code><code class="php string">'$type'</code><code class="php plain">)"; </code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number26 index25 alt1"><code class="php plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php comments">//模拟下单操作</code></div><div class="line number29 index28 alt2"><code class="php comments">//库存是否大于0</code></div><div class="line number30 index29 alt1"><code class="php plain">mysql_query(</code><code class="php string">"BEGIN"</code><code class="php plain">);&nbsp;&nbsp; </code><code class="php comments">//开始事务</code></div><div class="line number31 index30 alt2"><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"select number from ih_store where goods_id='$goods_id' and sku_id='$sku_id' FOR UPDATE"</code><code class="php plain">;</code><code class="php comments">//此时这条记录被锁住,其它事务必须等待此次事务提交后才能执行</code></div><div class="line number32 index31 alt1"><code class="php variable">$rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">);</code></div><div class="line number33 index32 alt2"><code class="php variable">$row</code><code class="php plain">=mysql_fetch_assoc(</code><code class="php variable">$rs</code><code class="php plain">);</code></div><div class="line number34 index33 alt1"><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$row</code><code class="php plain">[</code><code class="php string">'number'</code><code class="php plain">]&gt;0){</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//生成订单 </code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_sn</code><code class="php plain">=build_order_no(); </code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_order(order_sn,user_id,goods_id,sku_id,price) </code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$order_sn'</code><code class="php plain">,</code><code class="php string">'$user_id'</code><code class="php plain">,</code><code class="php string">'$goods_id'</code><code class="php plain">,</code><code class="php string">'$sku_id'</code><code class="php plain">,</code><code class="php string">'$price'</code><code class="php plain">)"; </code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//库存减少</code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"update ih_store set number=number-{$number} where sku_id='$sku_id'"</code><code class="php plain">;</code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$store_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(mysql_affected_rows()){ </code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少成功'</code><code class="php plain">);</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php string">"COMMIT"</code><code class="php plain">);</code><code class="php comments">//事务提交即解锁</code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{ </code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少失败'</code><code class="php plain">);</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code></div><div class="line number50 index49 alt1"><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{</code></div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存不够'</code><code class="php plain">);</code></div><div class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php string">"ROLLBACK"</code><code class="php plain">);</code></div><div class="line number53 index52 alt2"><code class="php plain">}</code></div><div class="line number54 index53 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff0000"><strong>优化方案3：</strong></span>使用非阻塞的文件排他锁</p>
<div class="jb51code">
<div><div id="highlighter_407305" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$conn</code><code class="php plain">=mysql_connect(</code><code class="php string">"localhost"</code><code class="php plain">,</code><code class="php string">"root"</code><code class="php plain">,</code><code class="php string">"123456"</code><code class="php plain">); </code></div><div class="line number3 index2 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php variable">$conn</code><code class="php plain">){ </code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"connect failed"</code><code class="php plain">; </code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">exit</code><code class="php plain">; </code></div><div class="line number6 index5 alt1"><code class="php plain">} </code></div><div class="line number7 index6 alt2"><code class="php plain">mysql_select_db(</code><code class="php string">"big-bak"</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number8 index7 alt1"><code class="php plain">mysql_query(</code><code class="php string">"set names utf8"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php variable">$price</code><code class="php plain">=10;</code></div><div class="line number11 index10 alt2"><code class="php variable">$user_id</code><code class="php plain">=1;</code></div><div class="line number12 index11 alt1"><code class="php variable">$goods_id</code><code class="php plain">=1;</code></div><div class="line number13 index12 alt2"><code class="php variable">$sku_id</code><code class="php plain">=11;</code></div><div class="line number14 index13 alt1"><code class="php variable">$number</code><code class="php plain">=1;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="php comments">//生成唯一订单号</code></div><div class="line number17 index16 alt2"><code class="php keyword">function</code> <code class="php plain">build_order_no(){</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php functions">date</code><code class="php plain">(</code><code class="php string">'ymd'</code><code class="php plain">).</code><code class="php functions">substr</code><code class="php plain">(implode(NULL, </code><code class="php functions">array_map</code><code class="php plain">(</code><code class="php string">'ord'</code><code class="php plain">, </code><code class="php functions">str_split</code><code class="php plain">(</code><code class="php functions">substr</code><code class="php plain">(uniqid(), 7, 13), 1))), 0, 8);</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php comments">//记录日志</code></div><div class="line number21 index20 alt2"><code class="php keyword">function</code> <code class="php plain">insertLog(</code><code class="php variable">$event</code><code class="php plain">,</code><code class="php variable">$type</code><code class="php plain">=0){</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$conn</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_log(event,type) </code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$event'</code><code class="php plain">,</code><code class="php string">'$type'</code><code class="php plain">)"; </code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number26 index25 alt1"><code class="php plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php variable">$fp</code> <code class="php plain">= </code><code class="php functions">fopen</code><code class="php plain">(</code><code class="php string">"lock.txt"</code><code class="php plain">, </code><code class="php string">"w+"</code><code class="php plain">);</code></div><div class="line number29 index28 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php functions">flock</code><code class="php plain">(</code><code class="php variable">$fp</code><code class="php plain">,LOCK_EX | LOCK_NB)){</code></div><div class="line number30 index29 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"系统繁忙，请稍后再试"</code><code class="php plain">;</code></div><div class="line number31 index30 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code><code class="php plain">;</code></div><div class="line number32 index31 alt1"><code class="php plain">}</code></div><div class="line number33 index32 alt2"><code class="php comments">//下单</code></div><div class="line number34 index33 alt1"><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"select number from ih_store where goods_id='$goods_id' and sku_id='$sku_id'"</code><code class="php plain">;</code></div><div class="line number35 index34 alt2"><code class="php variable">$rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">);</code></div><div class="line number36 index35 alt1"><code class="php variable">$row</code><code class="php plain">=mysql_fetch_assoc(</code><code class="php variable">$rs</code><code class="php plain">);</code></div><div class="line number37 index36 alt2"><code class="php keyword">if</code><code class="php plain">(</code><code class="php variable">$row</code><code class="php plain">[</code><code class="php string">'number'</code><code class="php plain">]&gt;0){</code><code class="php comments">//库存是否大于0</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//模拟下单操作 </code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_sn</code><code class="php plain">=build_order_no(); </code></div><div class="line number40 index39 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_order(order_sn,user_id,goods_id,sku_id,price) </code></div><div class="line number41 index40 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$order_sn'</code><code class="php plain">,</code><code class="php string">'$user_id'</code><code class="php plain">,</code><code class="php string">'$goods_id'</code><code class="php plain">,</code><code class="php string">'$sku_id'</code><code class="php plain">,</code><code class="php string">'$price'</code><code class="php plain">)"; </code></div><div class="line number42 index41 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$order_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number43 index42 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code>&nbsp;</div><div class="line number44 index43 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php comments">//库存减少</code></div><div class="line number45 index44 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"update ih_store set number=number-{$number} where sku_id='$sku_id'"</code><code class="php plain">;</code></div><div class="line number46 index45 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$store_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number47 index46 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">if</code><code class="php plain">(mysql_affected_rows()){ </code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少成功'</code><code class="php plain">);</code></div><div class="line number49 index48 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">flock</code><code class="php plain">(</code><code class="php variable">$fp</code><code class="php plain">,LOCK_UN);</code><code class="php comments">//释放锁</code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{ </code></div><div class="line number51 index50 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少失败'</code><code class="php plain">);</code></div><div class="line number52 index51 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">} </code></div><div class="line number53 index52 alt2"><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{</code></div><div class="line number54 index53 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存不够'</code><code class="php plain">);</code></div><div class="line number55 index54 alt2"><code class="php plain">}</code></div><div class="line number56 index55 alt1"><code class="php plain">fclose(</code><code class="php variable">$fp</code><code class="php plain">);</code></div></div></td></tr></tbody></table></div></div>
</div>
<p><span style="color: #ff0000"><strong>优化方案4：</strong></span>使用redis队列，因为pop操作是原子的，即使有很多用户同时到达，也是依次执行，推荐使用（mysql事务在高并发下性能下降很厉害，文件锁的方式也是）</p>
<p>先将商品库存如队列</p>
<p>&nbsp;</p>
<div class="jb51code">
<div><div id="highlighter_560044" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$store</code><code class="php plain">=1000;</code></div><div class="line number3 index2 alt2"><code class="php variable">$redis</code><code class="php plain">=</code><code class="php keyword">new</code> <code class="php plain">Redis();</code></div><div class="line number4 index3 alt1"><code class="php variable">$result</code><code class="php plain">=</code><code class="php variable">$redis</code><code class="php plain">-&gt;connect(</code><code class="php string">'127.0.0.1'</code><code class="php plain">,6379);</code></div><div class="line number5 index4 alt2"><code class="php variable">$res</code><code class="php plain">=</code><code class="php variable">$redis</code><code class="php plain">-&gt;llen(</code><code class="php string">'goods_store'</code><code class="php plain">);</code></div><div class="line number6 index5 alt1"><code class="php functions">echo</code> <code class="php variable">$res</code><code class="php plain">;</code></div><div class="line number7 index6 alt2"><code class="php variable">$count</code><code class="php plain">=</code><code class="php variable">$store</code><code class="php plain">-</code><code class="php variable">$res</code><code class="php plain">;</code></div><div class="line number8 index7 alt1"><code class="php keyword">for</code><code class="php plain">(</code><code class="php variable">$i</code><code class="php plain">=0;</code><code class="php variable">$i</code><code class="php plain">&lt;</code><code class="php variable">$count</code><code class="php plain">;</code><code class="php variable">$i</code><code class="php plain">++){</code></div><div class="line number9 index8 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$redis</code><code class="php plain">-&gt;lpush(</code><code class="php string">'goods_store'</code><code class="php plain">,1);</code></div><div class="line number10 index9 alt1"><code class="php plain">}</code></div><div class="line number11 index10 alt2"><code class="php functions">echo</code> <code class="php variable">$redis</code><code class="php plain">-&gt;llen(</code><code class="php string">'goods_store'</code><code class="php plain">);</code></div><div class="line number12 index11 alt1"><code class="php plain">?&gt;</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>抢购、描述逻辑</p>
<div class="jb51code">
<div><div id="highlighter_155208" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">&lt;?php</code></div><div class="line number2 index1 alt1"><code class="php variable">$conn</code><code class="php plain">=mysql_connect(</code><code class="php string">"localhost"</code><code class="php plain">,</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php string">"123456"</code><code class="php plain">); </code></div><div class="line number3 index2 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php variable">$conn</code><code class="php plain">){ </code></div><div class="line number4 index3 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">echo</code> <code class="php string">"connect failed"</code><code class="php plain">; </code></div><div class="line number5 index4 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php functions">exit</code><code class="php plain">; </code></div><div class="line number6 index5 alt1"><code class="php plain">} </code></div><div class="line number7 index6 alt2"><code class="php plain">mysql_select_db(</code><code class="php string">"big"</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number8 index7 alt1"><code class="php plain">mysql_query(</code><code class="php string">"set names utf8"</code><code class="php plain">);</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="php variable">$price</code><code class="php plain">=10;</code></div><div class="line number11 index10 alt2"><code class="php variable">$user_id</code><code class="php plain">=1;</code></div><div class="line number12 index11 alt1"><code class="php variable">$goods_id</code><code class="php plain">=1;</code></div><div class="line number13 index12 alt2"><code class="php variable">$sku_id</code><code class="php plain">=11;</code></div><div class="line number14 index13 alt1"><code class="php variable">$number</code><code class="php plain">=1;</code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="php comments">//生成唯一订单号</code></div><div class="line number17 index16 alt2"><code class="php keyword">function</code> <code class="php plain">build_order_no(){</code></div><div class="line number18 index17 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php keyword">return</code> <code class="php functions">date</code><code class="php plain">(</code><code class="php string">'ymd'</code><code class="php plain">).</code><code class="php functions">substr</code><code class="php plain">(implode(NULL, </code><code class="php functions">array_map</code><code class="php plain">(</code><code class="php string">'ord'</code><code class="php plain">, </code><code class="php functions">str_split</code><code class="php plain">(</code><code class="php functions">substr</code><code class="php plain">(uniqid(), 7, 13), 1))), 0, 8);</code></div><div class="line number19 index18 alt2"><code class="php plain">}</code></div><div class="line number20 index19 alt1"><code class="php comments">//记录日志</code></div><div class="line number21 index20 alt2"><code class="php keyword">function</code> <code class="php plain">insertLog(</code><code class="php variable">$event</code><code class="php plain">,</code><code class="php variable">$type</code><code class="php plain">=0){</code></div><div class="line number22 index21 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">global</code> <code class="php variable">$conn</code><code class="php plain">;</code></div><div class="line number23 index22 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php variable">$sql</code><code class="php plain">="insert into ih_log(event,type) </code></div><div class="line number24 index23 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">values(</code><code class="php string">'$event'</code><code class="php plain">,</code><code class="php string">'$type'</code><code class="php plain">)"; </code></div><div class="line number25 index24 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number26 index25 alt1"><code class="php plain">}</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php comments">//模拟下单操作</code></div><div class="line number29 index28 alt2"><code class="php comments">//下单前判断redis队列库存量</code></div><div class="line number30 index29 alt1"><code class="php variable">$redis</code><code class="php plain">=</code><code class="php keyword">new</code> <code class="php plain">Redis();</code></div><div class="line number31 index30 alt2"><code class="php variable">$result</code><code class="php plain">=</code><code class="php variable">$redis</code><code class="php plain">-&gt;connect(</code><code class="php string">'127.0.0.1'</code><code class="php plain">,6379);</code></div><div class="line number32 index31 alt1"><code class="php variable">$count</code><code class="php plain">=</code><code class="php variable">$redis</code><code class="php plain">-&gt;lpop(</code><code class="php string">'goods_store'</code><code class="php plain">);</code></div><div class="line number33 index32 alt2"><code class="php keyword">if</code><code class="php plain">(!</code><code class="php variable">$count</code><code class="php plain">){</code></div><div class="line number34 index33 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'error:no store redis'</code><code class="php plain">);</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php keyword">return</code><code class="php plain">;</code></div><div class="line number36 index35 alt1"><code class="php plain">}</code></div><div class="line number37 index36 alt2">&nbsp;</div><div class="line number38 index37 alt1"><code class="php comments">//生成订单 </code></div><div class="line number39 index38 alt2"><code class="php variable">$order_sn</code><code class="php plain">=build_order_no();</code></div><div class="line number40 index39 alt1"><code class="php variable">$sql</code><code class="php plain">="insert into ih_order(order_sn,user_id,goods_id,sku_id,price) </code></div><div class="line number41 index40 alt2"><code class="php plain">values(</code><code class="php string">'$order_sn'</code><code class="php plain">,</code><code class="php string">'$user_id'</code><code class="php plain">,</code><code class="php string">'$goods_id'</code><code class="php plain">,</code><code class="php string">'$sku_id'</code><code class="php plain">,</code><code class="php string">'$price'</code><code class="php plain">)"; </code></div><div class="line number42 index41 alt1"><code class="php variable">$order_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number43 index42 alt2">&nbsp;</div><div class="line number44 index43 alt1"><code class="php comments">//库存减少</code></div><div class="line number45 index44 alt2"><code class="php variable">$sql</code><code class="php plain">=</code><code class="php string">"update ih_store set number=number-{$number} where sku_id='$sku_id'"</code><code class="php plain">;</code></div><div class="line number46 index45 alt1"><code class="php variable">$store_rs</code><code class="php plain">=mysql_query(</code><code class="php variable">$sql</code><code class="php plain">,</code><code class="php variable">$conn</code><code class="php plain">); </code></div><div class="line number47 index46 alt2"><code class="php keyword">if</code><code class="php plain">(mysql_affected_rows()){ </code></div><div class="line number48 index47 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少成功'</code><code class="php plain">);</code></div><div class="line number49 index48 alt2"><code class="php plain">}</code><code class="php keyword">else</code><code class="php plain">{ </code></div><div class="line number50 index49 alt1"><code class="php spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="php plain">insertLog(</code><code class="php string">'库存减少失败'</code><code class="php plain">);</code></div><div class="line number51 index50 alt2"><code class="php plain">}</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>模拟5000高并发测试</p>
<p>webbench -c 5000 -t 60 http://192.168.1.198/big/index.php<br>
ab -r -n 6000 -c 5000&nbsp; http://192.168.1.198/big/index.php</p>
<p>上述只是简单模拟高并发下的抢购，真实场景要比这复杂很多，很多注意的地方</p>
<p>如抢购页面做成静态的，通过ajax调用接口</p>
<p>再如上面的会导致一个用户抢多个，思路：</p>
<p>需要一个排队队列和抢购结果队列及库存队列。高并发情况，先将用户进入排队队列，用一个线程循环处理从排队队列取出一个用户，判断用户是否已在抢购结果队列，如果在，则已抢购，否则未抢购，库存减1，写<span style="color: #ff00ff"><strong>数据库</strong></span>，将用户入结果队列。</p>
<p><span style="color: #ff0000"><strong>测试数据表</strong></span></p>
<div class="jb51code">
<div><div id="highlighter_916405" class="syntaxhighlighter  php"><div class="toolbar"><span><a href="http://www.jb51.net/article/100050.htm#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2">51</div><div class="line number52 index51 alt1">52</div><div class="line number53 index52 alt2">53</div><div class="line number54 index53 alt1">54</div><div class="line number55 index54 alt2">55</div><div class="line number56 index55 alt1">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="php plain">--</code></div><div class="line number2 index1 alt1"><code class="php plain">-- 数据库: `big`</code></div><div class="line number3 index2 alt2"><code class="php plain">--</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="php plain">-- --------------------------------------------------------</code></div><div class="line number6 index5 alt1">&nbsp;</div><div class="line number7 index6 alt2"><code class="php plain">--</code></div><div class="line number8 index7 alt1"><code class="php plain">-- 表的结构 `ih_goods`</code></div><div class="line number9 index8 alt2"><code class="php plain">--</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="php plain">CREATE TABLE IF NOT EXISTS `ih_goods` (</code></div><div class="line number13 index12 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">`goods_id` int(10) unsigned NOT NULL AUTO_INCREMENT,</code></div><div class="line number14 index13 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">`cat_id` int(11) NOT NULL,</code></div><div class="line number15 index14 alt2"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">`goods_name` varchar(255) NOT NULL,</code></div><div class="line number16 index15 alt1"><code class="php spaces">&nbsp;&nbsp;</code><code class="php plain">PRIMARY KEY (`goods_id`)</code></div><div class="line number17 index16 alt2"><code class="php plain">) ENGINE=MyISAM &nbsp;DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2">&nbsp;</div><div class="line number20 index19 alt1"><code class="php plain">--</code></div><div class="line number21 index20 alt2"><code class="php plain">-- 转存表中的数据 `ih_goods`</code></div><div class="line number22 index21 alt1"><code class="php plain">--</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="php plain">INSERT INTO `ih_goods` (`goods_id`, `cat_id`, `goods_name`) VALUES</code></div><div class="line number26 index25 alt1"><code class="php plain">(1, 0, </code><code class="php string">'小米手机'</code><code class="php plain">);</code></div><div class="line number27 index26 alt2">&nbsp;</div><div class="line number28 index27 alt1"><code class="php plain">-- --------------------------------------------------------</code></div><div class="line number29 index28 alt2">&nbsp;</div><div class="line number30 index29 alt1"><code class="php plain">--</code></div><div class="line number31 index30 alt2"><code class="php plain">-- 表的结构 `ih_log`</code></div><div class="line number32 index31 alt1"><code class="php plain">--</code></div><div class="line number33 index32 alt2">&nbsp;</div><div class="line number34 index33 alt1"><code class="php plain">CREATE TABLE IF NOT EXISTS `ih_log` (</code></div><div class="line number35 index34 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`id` int(11) NOT NULL AUTO_INCREMENT,</code></div><div class="line number36 index35 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`event` varchar(255) NOT NULL,</code></div><div class="line number37 index36 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`type` tinyint(4) NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number38 index37 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`addtime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</code></div><div class="line number39 index38 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">PRIMARY KEY (`id`)</code></div><div class="line number40 index39 alt1"><code class="php plain">) ENGINE=MyISAM DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="php plain">--</code></div><div class="line number43 index42 alt2"><code class="php plain">-- 转存表中的数据 `ih_log`</code></div><div class="line number44 index43 alt1"><code class="php plain">--</code></div><div class="line number45 index44 alt2">&nbsp;</div><div class="line number46 index45 alt1">&nbsp;</div><div class="line number47 index46 alt2"><code class="php plain">-- --------------------------------------------------------</code></div><div class="line number48 index47 alt1">&nbsp;</div><div class="line number49 index48 alt2"><code class="php plain">--</code></div><div class="line number50 index49 alt1"><code class="php plain">-- 表的结构 `ih_order`</code></div><div class="line number51 index50 alt2"><code class="php plain">--</code></div><div class="line number52 index51 alt1">&nbsp;</div><div class="line number53 index52 alt2"><code class="php plain">CREATE TABLE IF NOT EXISTS `ih_order` (</code></div><div class="line number54 index53 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`id` int(11) NOT NULL AUTO_INCREMENT,</code></div><div class="line number55 index54 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`order_sn` char(32) NOT NULL,</code></div><div class="line number56 index55 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`user_id` int(11) NOT NULL,</code></div><div class="line number57 index56 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`status` int(11) NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number58 index57 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`goods_id` int(11) NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number59 index58 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`sku_id` int(11) NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number60 index59 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`price` float NOT NULL,</code></div><div class="line number61 index60 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`addtime` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,</code></div><div class="line number62 index61 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">PRIMARY KEY (`id`)</code></div><div class="line number63 index62 alt2"><code class="php plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=</code><code class="php string">'订单表'</code> <code class="php plain">AUTO_INCREMENT=1 ;</code></div><div class="line number64 index63 alt1">&nbsp;</div><div class="line number65 index64 alt2"><code class="php plain">--</code></div><div class="line number66 index65 alt1"><code class="php plain">-- 转存表中的数据 `ih_order`</code></div><div class="line number67 index66 alt2"><code class="php plain">--</code></div><div class="line number68 index67 alt1">&nbsp;</div><div class="line number69 index68 alt2">&nbsp;</div><div class="line number70 index69 alt1"><code class="php plain">-- --------------------------------------------------------</code></div><div class="line number71 index70 alt2">&nbsp;</div><div class="line number72 index71 alt1"><code class="php plain">--</code></div><div class="line number73 index72 alt2"><code class="php plain">-- 表的结构 `ih_store`</code></div><div class="line number74 index73 alt1"><code class="php plain">--</code></div><div class="line number75 index74 alt2">&nbsp;</div><div class="line number76 index75 alt1"><code class="php plain">CREATE TABLE IF NOT EXISTS `ih_store` (</code></div><div class="line number77 index76 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`id` int(11) NOT NULL AUTO_INCREMENT,</code></div><div class="line number78 index77 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`goods_id` int(11) NOT NULL,</code></div><div class="line number79 index78 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`sku_id` int(10) unsigned NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number80 index79 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">`number` int(10) NOT NULL DEFAULT </code><code class="php string">'0'</code><code class="php plain">,</code></div><div class="line number81 index80 alt2"><code class="php spaces">&nbsp;</code><code class="php plain">`freez` int(11) NOT NULL DEFAULT </code><code class="php string">'0'</code> <code class="php plain">COMMENT </code><code class="php string">'虚拟库存'</code><code class="php plain">,</code></div><div class="line number82 index81 alt1"><code class="php spaces">&nbsp;</code><code class="php plain">PRIMARY KEY (`id`)</code></div><div class="line number83 index82 alt2"><code class="php plain">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=</code><code class="php string">'库存'</code> <code class="php plain">AUTO_INCREMENT=2 ;</code></div><div class="line number84 index83 alt1">&nbsp;</div><div class="line number85 index84 alt2"><code class="php plain">--</code></div><div class="line number86 index85 alt1"><code class="php plain">-- 转存表中的数据 `ih_store`</code></div><div class="line number87 index86 alt2"><code class="php plain">--</code></div><div class="line number88 index87 alt1">&nbsp;</div><div class="line number89 index88 alt2"><code class="php plain">INSERT INTO `ih_store` (`id`, `goods_id`, `sku_id`, `number`, `freez`) VALUES</code></div><div class="line number90 index89 alt1"><code class="php plain">(1, 1, 11, 500, 0);</code></div></div></td></tr></tbody></table></div></div>
</div>
<p>以上就是小编为大家带来的php结合redis实现高并发下的抢购、秒杀功能的实例全部内容了，希望大家多多支持脚本之家~</p>

<p class="content-shequ">如对本文有疑问，请提交到交流社区，广大热心网友会为你解答！！  <a href="http://shequ.jb51.net/" target="_blank">点击进入社区</a></p></div><!--endmain-->
<div class="art_xg">
<h4>您可能感兴趣的文章:</h4><ul><li><a href="http://www.jb51.net/article/112827.htm" title="PHP基于Redis消息队列实现发布微博的方法" target="_blank">PHP基于Redis消息队列实现发布微博的方法</a></li><li><a href="http://www.jb51.net/article/109695.htm" title="php中Redis的应用--消息传递" target="_blank">php中Redis的应用--消息传递</a></li><li><a href="http://www.jb51.net/article/100055.htm" title="phpredis提高消息队列的实时性方法(推荐)" target="_blank">phpredis提高消息队列的实时性方法(推荐)</a></li><li><a href="http://www.jb51.net/article/87634.htm" title="PHP使用php-resque库配合Redis实现MQ消息队列的教程" target="_blank">PHP使用php-resque库配合Redis实现MQ消息队列的教程</a></li><li><a href="http://www.jb51.net/article/42729.htm" title="php Session存储到Redis的方法" target="_blank">php Session存储到Redis的方法</a></li><li><a href="http://www.jb51.net/article/74851.htm" title="PHP实现操作redis的封装类完整实例" target="_blank">PHP实现操作redis的封装类完整实例</a></li><li><a href="http://www.jb51.net/article/50404.htm" title="redis安装、配置、使用和redis php扩展安装教程" target="_blank">redis安装、配置、使用和redis php扩展安装教程</a></li><li><a href="http://www.jb51.net/article/47050.htm" title="PHP中redis的用法深入解析" target="_blank">PHP中redis的用法深入解析</a></li><li><a href="http://www.jb51.net/article/84283.htm" title="ThinkPHP自定义Redis处理SESSION的实现方法" target="_blank">ThinkPHP自定义Redis处理SESSION的实现方法</a></li><li><a href="http://www.jb51.net/article/116862.htm" title="PHP使用redis消息队列发布微博的方法示例" target="_blank">PHP使用redis消息队列发布微博的方法示例</a></li></ul>
</div>
<div class="lbd clearfix">
<div id="_2fbyzz7riuyfycsvoj4qwd0a4i" style="width: 100%;"><p style="display:none"></p><iframe width="650" frameborder="0" height="250" scrolling="no" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/s(1).html"></iframe><p style="display:none"></p></div><script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/z8dje9abx1.js"></script>

</div>
<div id="shoucang"></div>
<div class="tags mt10">
<strong>Tags：</strong><a href="http://common.jb51.net/tag/php/1.htm" target="_blank" title="搜索关于php的文章">php</a> <a href="http://common.jb51.net/tag/%E6%8A%A2%E8%B4%AD/1.htm" target="_blank" title="搜索关于抢购的文章">抢购</a> <a href="http://common.jb51.net/tag/%E5%B9%B6%E5%8F%91/1.htm" target="_blank" title="搜索关于并发的文章">并发</a> <a href="http://common.jb51.net/tag/redis/1.htm" target="_blank" title="搜索关于redis的文章">redis</a> 
</div>
<div class="relatedarticle clearfix mt5">
<h2>相关文章</h2>
<ul><li><span>2016-10-10</span><a href="http://www.jb51.net/article/95997.htm" title="Redis主从实现读写分离" target="_blank">Redis主从实现读写分离</a></li><li><span>2015-01-01</span><a href="http://www.jb51.net/article/59429.htm" title="Redis总结笔记（一）：安装和常用命令" target="_blank">Redis总结笔记（一）：安装和常用命令</a></li><li><span>2015-04-04</span><a href="http://www.jb51.net/article/65267.htm" title="Redis教程(十二)：服务器管理命令总结" target="_blank">Redis教程(十二)：服务器管理命令总结</a></li><li><span>2015-04-04</span><a href="http://www.jb51.net/article/65259.htm" title="Redis教程(八)：事务详解" target="_blank">Redis教程(八)：事务详解</a></li><li><span>2016-12-12</span><a href="http://www.jb51.net/article/100050.htm" title="php结合redis实现高并发下的抢购、秒杀功能的实例" target="_blank">php结合redis实现高并发下的抢购、秒杀功能的实例</a></li><li><span>2016-09-09</span><a href="http://www.jb51.net/article/92034.htm" title="详解Redis用链表实现消息队列" target="_blank">详解Redis用链表实现消息队列</a></li><li><span>2015-06-06</span><a href="http://www.jb51.net/article/68259.htm" title="Redis2.8配置文件中文详解" target="_blank">Redis2.8配置文件中文详解</a></li><li><span>2015-03-03</span><a href="http://www.jb51.net/article/62646.htm" title="Redis数据库的使用场景介绍（避免误用Redis）" target="_blank">Redis数据库的使用场景介绍（避免误用Redis）</a></li><li><span>2016-05-05</span><a href="http://www.jb51.net/article/84071.htm" title="Windows下Redis的安装使用教程" target="_blank">Windows下Redis的安装使用教程</a></li><li><span>2016-11-11</span><a href="http://www.jb51.net/article/96230.htm" title="Windows下Redis安装配置教程" target="_blank">Windows下Redis安装配置教程</a></li></ul>
</div>
<div class="lbd clearfix mt5">
<div id="_tz05w39p0e0qrrerpsfapds4i" style="width: 100%;"><p style="display:none"></p><div><iframe width="680" frameborder="0" height="200" scrolling="no" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/s(2).html"></iframe></div><p style="display:none"></p></div><script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/tb3a1ecf96f1cdf739db1c7481b2b03ded00b3930a3ef6.js"></script>

</div>
<a href="http://www.jb51.net/article/100050.htm#comments"></a>
<div id="comments">
<h2>最新评论</h2>
<div class="pd5"><div id="SOHUCS" sid="art_100050" style="width: 100%; height: auto;"><div id="SOHU_MAIN"><div id="SOHU-comment-main" class="sohu-comment-wrapper"><div id="article_info_sohu">        <div class="reset-g clear-g section-title-w  section-title-logoutStyle">
            <div class="title-join-w">
                <div class="join-wrap-w join-wrap-b"><strong class="wrap-name-w wrap-name-b">评论</strong><span class="wrap-join-w wrap-join-b">(<em class="join-strong-gw join-strong-bg">2</em><span node-type="involved">人参与</span><i class="gap-b">，</i><em class="join-strong-gw join-strong-bg">0</em><span node-type="comments">条评论</span>)</span></div>
            </div>
            <div class="title-user-w">
                <div node-type="sohu-pact" class="title-link-w" style="display: none;"><a href="http://zt.pinglun.sohu.com/s2014/sljyhgy/index.shtml" target="_blank">搜狐“我来说两句”用户公约</a></div>
            </div>
        </div>
        </div><div id="login_sohu"></div><div id="comment_sohu"><div node-type="cbox-wrapper" class="reset-g section-cbox-w"><div style="width:1px;height:1px;overflow:hidden;"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/vcode.jpg" style="visibility:hidden;width:1px;height:1px;"></div><div class="clear-g cbox-block-w">
            <div class="block-head-w">
                <div class="head-img-w">
                                        <a node-type="user-avatar" href="javascript:void(0)" target="_self"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/pic42_null.gif" onerror="SOHUCS.isImgErr(this)" width="42" height="42" alt=""></a>
                    </div>
                <!--
                -->
            </div>
        <div class="block-post-w block-post-default-e"><div class="post-wrap-w post-wrap-b"><div class="wrap-area-w"><div class="area-textarea-w" style="position:relative;zoom:1;z-index:9;"><textarea name="" class="textarea-fw textarea-bf">来说两句吧...</textarea></div></div><div class="clear-g wrap-action-w wrap-action-b"><div class="action-function-w action-function-b relative-z-w"><ul class="clear-g"><li class="function-face-w"><a href="javascript:void(0)" class="effect-w" title="表情"><i class="face-b"></i></a></li><li class="function-uploadimg-w"><a href="javascript:void(0)" class="effect-w" title="上传图片"><i class="uploadimg-b"></i></a><div class="uploadimg-file-w"><input class="file-fw" id="img_upload" name="file" type="file" accept="image/*"></div><div class="img-btn-cover" style="width:40px;height:40px;margin-top:-40px;z-index:-1;position: relative;"></div></li><!--<li class="function-at-w"><a href="javascript:void(0)" class="effect-w"><i class="at-b"></i></a></li>--></ul></div><div class="clear-g action-issue-w"><div class="issue-btn-w"><a href="javascript:void(0)"><button class="btn-fw btn-bf btn-fw-main">发布</button></a></div></div></div></div>
                                    <div node-type="login-list" class="post-login-w">
                <ul class="clear-g">
                                                            <li style="display:block">
                        <div class="login-wrap-w login-wrap-b">
                            <a data-key="sina" target="_self" href="javascript:;" title="新浪微博" alt="新浪微博">
                                <span class="wrap-icon-w icon30-sina-b"></span><span class="wrap-name-w wrap-name-b">微博登录</span>
                            </a>
                        </div>
                    </li>
                                        <li style="display:block">
                        <div class="login-wrap-w login-wrap-b">
                            <a data-key="qq" target="_self" href="javascript:;" title="QQ" alt="QQ">
                                <span class="wrap-icon-w icon30-qq-b"></span><span class="wrap-name-w wrap-name-b">QQ登录</span>
                            </a>
                        </div>
                    </li>
                                        <li style="display:">
                        <div class="login-wrap-w login-wrap-b">
                            <a data-key="" target="_self" href="javascript:;" title="" alt="">
                                <span class="wrap-icon-w icon30--b"></span><span class="wrap-name-w wrap-name-b"></span>
                            </a>
                        </div>
                    </li>
                                        <li>
                        <div class="login-wrap-w login-wrap-b login-wrap-phone-b">
                            <a data-key="phone" target="_self" href="javascript:void(0)">
                                <span class="wrap-icon-w icon30-phone-b"></span><span class="wrap-name-w wrap-name-b">手机登录</span>
                            </a>
                        </div>
                    </li>
                    </ul>
            </div>
            </div></div><div node-type="prompt-no-privilege" class="cbox-prompt-w" style="display: none;">
            <span class="prompt-empty-w prompt-empty-b">等级不够，发表评论升至指定级别才能获得该特权。详情请参见<a node-type="privilege-intro" href="javascript:;">等级说明</a>。</span>
        </div></div></div><div id="list_sort_sohu"></div><div id="list_sohu" topicid="2181759323">
        <div class="reset-g section-list-w">
            <div class="list-comment-empty-w">
                <div class="empty-prompt-w"><span class="prompt-null-w prompt-null-b">还没有评论，快来抢沙发吧！</span></div>
            </div>
        </div></div><div id="list_hot"></div><div id="page_sohu"></div><div id="more_list_sohu"></div><div id="powerby_sohu">        <div class="reset-g section-service-w">
            <div class="service-wrap-w service-wrap-b"><a node-type="powered-by" href="http://changyan.sohu.com/?from=changyan" target="_blank">Powered by 畅言</a></div>
        </div></div></div></div></div></div>
</div>
      </div><!--endborder-->
      </div><!--end fl-->
      
<div class="w300 fr">
<div class="r300 clearfix"><script async="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/adsbygoogle.js"></script><ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-6384567588307613" data-ad-slot="2817964327" data-adsbygoogle-status="done"><ins id="aswift_0_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_0_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_0" name="aswift_0" style="left:0;position:absolute;top:0;width:300px;height:250px;"></iframe></ins></ins></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">大家感兴趣的内容</h4>
<ul class="newsList newList-in">
<li><em class="no1">1</em><a href="http://www.jb51.net/article/56448.htm" title="超强、超详细Redis数据库入门教程" target="_blank">超强、超详细Redis数据库入门教程</a></li><li><em class="no2">2</em><a href="http://www.jb51.net/article/60627.htm" title="redis常用命令、常见错误、配置技巧等分享" target="_blank">redis常用命令、常见错误、配置技</a></li><li><em class="no3">3</em><a href="http://www.jb51.net/article/61793.htm" title="Redis操作命令总结" target="_blank">Redis操作命令总结</a></li><li><em class="no4">4</em><a href="http://www.jb51.net/article/54747.htm" title="64位Windows下安装Redis教程" target="_blank">64位Windows下安装Redis教程</a></li><li><em class="no5">5</em><a href="http://www.jb51.net/article/54774.htm" title="Redis中5种数据结构的使用场景介绍" target="_blank">Redis中5种数据结构的使用场景介</a></li><li><em class="no6">6</em><a href="http://www.jb51.net/article/57066.htm" title="redis中使用redis-dump导出、导入、还原数据实例" target="_blank">redis中使用redis-dump导出、导入</a></li><li><em class="no7">7</em><a href="http://www.jb51.net/article/62877.htm" title="Redis中统计各种数据大小的方法" target="_blank">Redis中统计各种数据大小的方法</a></li><li><em class="no8">8</em><a href="http://www.jb51.net/article/51625.htm" title="redis常用命令小结" target="_blank">redis常用命令小结</a></li><li><em class="no9">9</em><a href="http://www.jb51.net/article/62507.htm" title="CentOS 6.6下Redis安装配置记录" target="_blank">CentOS 6.6下Redis安装配置记录</a></li><li><em class="no10">10</em><a href="http://www.jb51.net/article/51624.htm" title="让Redis在你的系统中发挥更大作用的几点建议" target="_blank">让Redis在你的系统中发挥更大作用</a></li>
</ul>
</div>
</div>
<div class="r300 clearfix mt10"><script async="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/adsbygoogle.js"></script><!--thea+300*250--><ins class="adsbygoogle" style="display: inline-block; width: 300px; height: 250px;" data-ad-client="ca-pub-6389290466807248" data-ad-slot="6788945816" data-adsbygoogle-status="done"><ins id="aswift_1_expand" style="display:inline-table;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><ins id="aswift_1_anchor" style="display:block;border:none;height:250px;margin:0;padding:0;position:relative;visibility:visible;width:300px;background-color:transparent"><iframe width="300" height="250" frameborder="0" marginwidth="0" marginheight="0" vspace="0" hspace="0" allowtransparency="true" scrolling="no" allowfullscreen="true" onload="var i=this.id,s=window.google_iframe_oncopy,H=s&amp;&amp;s.handlers,h=H&amp;&amp;H[i],w=this.contentWindow,d;try{d=w.document}catch(e){}if(h&amp;&amp;d&amp;&amp;(!d.body||!d.body.firstChild)){if(h.call){setTimeout(h,0)}else if(h.match){try{h=s.upd(h,i)}catch(e){}w.location.replace(h)}}" id="aswift_1" name="aswift_1" style="left:0;position:absolute;top:0;width:300px;height:250px;"></iframe></ins></ins></ins><script>(adsbygoogle=window.adsbygoogle||[]).push({});</script><div class="blank10"></div><a href="http://click.aliyun.com/m/21950/" target="_blank"><img alt="" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/ali_300_1.jpg" width="300" height="100"></a><div class="blank10"></div>
</div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">最近更新的内容</h4>
<ul class="newsListA">
<ul><li><a href="http://www.jb51.net/article/68260.htm" title="Redis的LRU机制介绍" target="_blank">Redis的LRU机制介绍</a></li><li><a href="http://www.jb51.net/article/65266.htm" title="Redis教程(十一)：虚拟内存介绍" target="_blank">Redis教程(十一)：虚拟内存介绍</a></li><li><a href="http://www.jb51.net/article/82996.htm" title="Redis Stat的安装指南" target="_blank">Redis Stat的安装指南</a></li><li><a href="http://www.jb51.net/article/51623.htm" title="Redis数据库的安装配置方法" target="_blank">Redis数据库的安装配置方法</a></li><li><a href="http://www.jb51.net/article/62507.htm" title="CentOS 6.6下Redis安装配置记录" target="_blank">CentOS 6.6下Redis安装配置记录</a></li><li><a href="http://www.jb51.net/article/56676.htm" title="CentOS Linux系统下安装Redis过程和配置参数说明" target="_blank">CentOS Linux系统下安装Redis过程和配置参</a></li><li><a href="http://www.jb51.net/article/109076.htm" title="Redis发布订阅和实现.NET客户端详解" target="_blank">Redis发布订阅和实现.NET客户端详解</a></li><li><a href="http://www.jb51.net/article/68513.htm" title="Redis数据库中实现分布式锁的方法" target="_blank">Redis数据库中实现分布式锁的方法</a></li><li><a href="http://www.jb51.net/article/60627.htm" title="redis常用命令、常见错误、配置技巧等分享" target="_blank">redis常用命令、常见错误、配置技巧等分享</a></li><li><a href="http://www.jb51.net/article/82438.htm" title="Redis实现信息已读未读状态提示" target="_blank">Redis实现信息已读未读状态提示</a></li></ul>
</ul>
</div>
</div>   
<div class="r300 clearfix mt10"><div class="idc3"><a href="http://www.021.net/" target="_blank"><h1>众生网络</h1><span>品牌服务器租用</span> </a><a href="http://www.geisnic.com/" target="_blank"><h1>集思网络</h1><span>VPS主机</span> </a><a href="http://www.33ip.com/" target="_blank"><h1>枫信科技</h1><span>IDC服务商</span> </a></div>
</div>
<div class="tabTitleBar mt10 bgf borderTblue">
<div class="borderTnone pb10 YaHei">
<h4 class="blue">常用在线小工具</h4>
<ul class="newsListA"><li><a href="http://tools.jb51.net/code/css" target="_blank"><font color="red">CSS代码工具</font></a></li><li><a href="http://tools.jb51.net/transcoding/html_transcode" target="_blank"><font color="red">在线HTML转义/反转义工具</font></a></li><li><a href="http://tools.jb51.net/regex/create_reg" target="_blank">正则表达式在线生成工具</a></li><li><a href="http://tools.jb51.net/code/encodeTxt" target="_blank"><font color="red">JavaScript代码在线加密工具</font></a></li><li><a href="http://tools.jb51.net/code/json" target="_blank">JSON代码工具</a></li><li><a href="http://tools.jb51.net/color/jPicker" target="_blank">RGB颜色查询对照表_配色工具</a></li><li><a href="http://tools.jb51.net/code/xmlformat" target="_blank">在线XML格式化/压缩工具</a></li><li><a href="http://tools.jb51.net/code/xmljson" target="_blank">在线XML/JSON互相转换工具</a></li><li><a href="http://www.jb51.net/tools/js_Debug.htm" target="_blank">在线JS脚本校验器错误</a></li><li><a href="http://tools.jb51.net/code/phpformat" target="_blank">php代码在线格式化美化工具</a></li>
</ul>
</div>
</div>
<div class="r300 clearfix mt10" id="idctu2"><a href="http://tuidc.com/" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/tengyou300.gif" width="300" height="100"></a><div class="blank10"></div><a href="http://www.enkj.com/encloud/" target="_blank"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/enkj_300.gif" alt="云服务器" width="300" height="100"></a>
</div>
<div class="mt10 rFixedBox" style="position: static; top: 0px;">
<script type="text/javascript">var cpro_id="u1397867";(window["cproStyleApi"] = window["cproStyleApi"] || {})[cpro_id]={at:"3",rsi0:"300",rsi1:"380",pat:"6",tn:"baiduCustNativeAD",rss1:"#FFFFFF",conBW:"1",adp:"1",ptt:"0",titFF:"%E5%BE%AE%E8%BD%AF%E9%9B%85%E9%BB%91",titFS:"14",rss2:"#000000",titSU:"0",ptbg:"90",piw:"0",pih:"0",ptp:"0"}</script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/c.js" type="text/javascript"></script><div id="BAIDU_SSP__wrapper_u1397867_0" style="width: 300px; height: 380px; display: inline-block;"><iframe id="iframeu1397867_0" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/mcpm.html" width="300" height="380" align="center,center" vspace="0" hspace="0" marginwidth="0" marginheight="0" scrolling="no" frameborder="0" style="border:0;vertical-align:bottom;margin:0;width:300px;height:380px" allowtransparency="true"></iframe></div>

</div>
      
      
      </div><!--end fr-->
      </div>
</div><!--end content-->
<div id="footer">
<div class="main clearfix">
<p>
<a href="http://www.jb51.net/about.htm" target="_blank">关于我们</a> - 
<a href="http://www.jb51.net/support.htm" target="_blank">广告合作</a> - 
<a href="http://www.jb51.net/linkus.htm" target="_blank">联系我们</a> -  
<a href="http://www.jb51.net/sm.htm" target="_blank">免责声明</a> -  
<a href="http://www.jb51.net/sitemap.htm" target="_blank">网站地图</a> - 
<a href="tencent://message/?uin=461478385&amp;Site=http://www.jb51.net" target="_blank">投诉建议</a> - 
<a href="http://www.jb51.net/up.htm" target="_blank">在线投稿</a>
</p>
<p>&#169;CopyRight 2006-2017 JB51.Net Inc All Rights Reserved. 脚本之家 版权所有</p>
</div>
   <div class="gotop" id="gotop" style="left: auto; display: block;">   <a href="javascript:;" class="jb51-weixin"></a>  <div class="jb51-weixin-con hide">     <h2 class="jb51-weixin-title">微信扫一扫</h2>    <div class="jb51-weixin-pic"> <img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/weixin_jb51.gif" alt="脚本之家微信账号" width="100" height="100"> </div>  </div>  <a href="http://shequ.jb51.net/" target="_blank" class="question"><img src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/hot.gif" alt="hot"></a>  <a href="javascript:;" class="go"></a>  </div></div><!--end footer-->
<link type="text/css" rel="stylesheet" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/shCore.css">
<link type="text/css" rel="Stylesheet" href="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/shThemeDefault.css">
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/shCore.js"></script>
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/shAutoloader.js"></script>
<script type="text/javascript">
(function(){
    var bp = document.createElement('script');
    bp.src = '//push.zhanzhang.baidu.com/push.js';
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
if (top.location != self.location)top.location=self.location;
$(function(){
	$('#content').find('img').each(function(){
        var img = this;
        if (img.width >= 650){
            img.style.width = "650px";
            img.style.height = "auto";
            //$(img).removeAttr('height');
            var aTag = document.createElement('a');
            aTag.href = img.src;
			aTag.target="_blank";
            $(aTag).addClass('bPic')
            .insertAfter(img).append(img)
          }
    });
	$(window).scroll(function()
    {	
    	//rFixedBox跟随滚动
    	var h = $(window).height();
        var top = $(window).scrollTop();
    	var rFixedBox = $('.rFixedBox').prev().offset();
        var fixedTop = rFixedBox.top;
		
        if(top>=fixedTop+344)
        {
			var h1 = parseInt($('#content').children('.main').height());
			if(parseInt(top) + 340 < h1){
				$('.rFixedBox').css({'position':'fixed','top': 0});
			}else{
				$('.rFixedBox').css({'position':'absolute','top': h1-510});
			}
        }
        else
        {
            $('.rFixedBox').css({'position':'static', 'top':0});   
        }	
       /* return true;*/
    });
/*$(document).ready(function() {
  $("#content img").unveil();
});	*/
SyntaxHighlighter.autoloader(
	'applescript			/jslib/syntaxhighlighter/scripts/shBrushAppleScript.js',
	'actionscript3 as3		/jslib/syntaxhighlighter/scripts/shBrushAS3.js',
	'bash shell				/jslib/syntaxhighlighter/scripts/shBrushBash.js',
	'coldfusion cf			/jslib/syntaxhighlighter/scripts/shBrushColdFusion.js',
	'cpp c					/jslib/syntaxhighlighter/scripts/shBrushCpp.js',
	'obj-c objc				/jslib/syntaxhighlighter/scripts/shBrushObjC.js',
	'c# c-sharp csharp		/jslib/syntaxhighlighter/scripts/shBrushCSharp.js',
	'css					/jslib/syntaxhighlighter/scripts/shBrushCss.js',
	'delphi pascal			/jslib/syntaxhighlighter/scripts/shBrushDelphi.js',
	'diff patch pas			/jslib/syntaxhighlighter/scripts/shBrushDiff.js',
	'erl erlang				/jslib/syntaxhighlighter/scripts/shBrushErlang.js',
	'groovy					/jslib/syntaxhighlighter/scripts/shBrushGroovy.js',
	'haxe hx				/jslib/syntaxhighlighter/scripts/shBrushHaxe.js',
	'java					/jslib/syntaxhighlighter/scripts/shBrushJava.js',
	'jfx javafx				/jslib/syntaxhighlighter/scripts/shBrushJavaFX.js',
	'js jscript javascript	/jslib/syntaxhighlighter/scripts/shBrushJScript.js',
	'perl pl				/jslib/syntaxhighlighter/scripts/shBrushPerl.js',
	'php					/jslib/syntaxhighlighter/scripts/shBrushPhp.js',
	'text plain				/jslib/syntaxhighlighter/scripts/shBrushPlain.js',
	'py python				/jslib/syntaxhighlighter/scripts/shBrushPython.js',
	'ruby rails ror rb		/jslib/syntaxhighlighter/scripts/shBrushRuby.js',
	'scala					/jslib/syntaxhighlighter/scripts/shBrushScala.js',
	'sql					/jslib/syntaxhighlighter/scripts/shBrushSql.js',
	'vb vbnet				/jslib/syntaxhighlighter/scripts/shBrushVb.js',
	'ps powershell			/jslib/syntaxhighlighter/scripts/shBrushPowerShell.js',
	'xml xhtml xslt html	/jslib/syntaxhighlighter/scripts/shBrushXml.js'
);
SyntaxHighlighter.all();
});
var ourl="";
</script>
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/arc.js"></script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<script>jbLoader();</script>
<div id="tongji">
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/tongji.js"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/i.js" type="text/javascript"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/stat.php" language="JavaScript"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/core.php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=1585378" target="_blank" title="站长统计">站长统计</a><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/stat(1).php" language="JavaScript"></script><script src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/core(1).php" charset="utf-8" type="text/javascript"></script><a href="http://www.cnzz.com/stat/website.php?web_id=5488916" target="_blank" title="站长统计">站长统计</a>
<script charset="utf-8" type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/changyan.js"></script>
<script type="text/javascript">
window.changyan.api.config({
appid: 'cyrHH3dwi',
conf: 'prod_1dc5dc80970106099d43fe242b7465fc'
});
</script>
</div> 
<script type="text/javascript" src="./php结合redis实现高并发下的抢购、秒杀功能的实例_Redis_脚本之家_files/pl.asp"></script>


<!-- published at 2017/7/3 17:41:52By dxycms qq:461478385  -->
</div><iframe id="google_osd_static_frame_439247470082" name="google_osd_static_frame" style="display: none; width: 0px; height: 0px;"></iframe></body></html>