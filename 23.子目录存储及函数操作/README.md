#第二十三天笔记
###is_uploaded_file
<pre>
is_uploaded_file — 判断文件是否是通过 HTTP POST 上传的
如果 filename 所给出的文件是通过 HTTP POST 上传的则返回 TRUE。这可以用来确保恶意的用户无法欺骗脚本去访问本不能访问的文件，例如 /etc/passwd。 

这种检查显得格外重要，如果上传的文件有可能会造成对用户或本系统的其他用户显示其内容的话。 

为了能使 is_uploaded_file() 函数正常工作，必段指定类似于 $_FILES['userfile']['tmp_name'] 的变量，而在从客户端上传的文件名 $_FILES['userfile']['name'] 不能正常运作。 
</pre>

###典型的上传实现
<pre>
去判断 临时上传文件，是否满足 我们的业务逻辑需求！
满足，再移动！

需要判断：
是否存在错误，类型是否符合要求，大小是否符合要求
目标文件生成合理的名字

编码实现

1.当前上传临时文件信息作为参数
2.判断是否有错误
3.判断文件类型
4.两种表示方式：
	后缀名(.jpg) 和 MIME(image/jpeg)
	后缀名：	在文件系统中，表示文件类型的方式！当文件存储在磁盘上时，表示文件类型的方式！
	MIME: text/html, image/jpeg, 在互联网上传输文件内容时，表示该内容的方法！MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型。

	判断类型时，通常两种方式都需要判断：
	一：后缀名： 	在原始文件名中截取
	strrchr(); 字符串函数，查找某个子字符串在字符串中最后一次出现的位置，并返回从该位置到字符串结尾的全部内容！
	二：Mime：		使用type元素值！

5.判断大小
6.设计目标文件位置
	目标文件名：
	不能重名，不能存在特殊字符，具有逻辑含义，保持原有后缀。
	建议使用 函数：uniqid(), 生成唯一字符串！
7.移动文件
	如果移动成功，应该返回，目标文件名！
	为了后续处理该文件。否则文件名时临时生成的，不容易确定！
8.分子目录存储上传文件
	为了减少 一个目录中文件过多！
	划分成不同的子目录：
	划分方案：

	按照业务逻辑： 	商品图片，用户logo。指定不同的upload_path即可
	文件数量：		每个目录存储2000个文件，数量达到，则创建新子目录！
	时间划分：		每个月（星期）使用一个上传子目录。


	时间划分：
		获取当前应该使用的子目录名：date()
		判断需要的目录是否存在：is_dir()是否为一个目录
		创建需要的目录：mkdir() 创建目录

创建子目录


移动到子目录


返回文件中包含子目录

安全性
对类型的限制
$_FILES中的type的信息，不是PHP检测出来的，而是浏览器提供的。

因此：PHP也需要检测文件类型才可以，不能完全信赖浏览器数据！

PHP检测文件的MIME类型（文件内容中，存储相关的类型）

PHP提供 fileinfo 相关函数（方法），来完成

开启fileinfo扩展
提供了面向对象的语法：
获取MIME类型

Is_uploaded_file();
判断 临时文件，是否为真实的上传文件！
</pre>


###多文件上传（重点）
<pre>
$_FILES结构。

有两种情况，
情况1，是文件名都不一样的多文件上传处理（这个跟那个单文件上传没有什么差别）

情况2，文件域name相关，数组方式命名,是文件名都是一样的数组型上传(这个的展示形式很不一样)
	
	此时$_FILES的结构如下：
	将 相关的整理到一个元素中，该元素对应 5个元素(name, type, tmp_name, error, size)的数组。
	每个name，对应三个值
	每个type,tmp_name, error, size都是如此：


下标一致的属于一个文件，只要获得每个下标，就可以通过下标获得对应的5个元素值！

编码实现
定义一个可以完成多文件上传的函数，针对于该情况：
</pre>

###错误类型
<pre>
Error，表示错误
0：没有错误
1：文件超过了PHP中对上传文件大小的设置(php.ini:upload_max_filesize = 2M)
2：文件过大，超过表单中元素(精确到每个表单层面！)
3：文件没有上传完
4：没有上传文件
5：上传的文件大小为0，上传的为空文件(约定，不是错误！PHP 没有定义 5 这个错！一般我们定义上传文件大小为0时，会发送一个为5的错误)
6：临时上传目录未找到(一般是文件夹权限不足，或者文件夹没有创建)
	PHP可以更改临时目录：
	Php.ini
7：临时文件写入失败(还有系统问题)
磁盘空间不足，权限不允许！
</pre>

###相关配置
<pre>
php.ini配置
	上传文件数量：max_file_uploads=20
	POST数据大小:post_max_size=8M

Post数据总大小。
超过总大小，PHP不处理post数据，$_POST$_FILES就是空数组！(包含文件与字段值)

需要值得注意:
Tip：文件仅仅可以以post的方法提交！

HTTP不适合上传超大文件！
</pre>

###商品添加表单[功能]
<pre>
创建商品表

处理商品数据[功能]

商品图片的处理

实现上传的方法
上传单个文件，上传多个文件！
将定义好的方法，在上传类中实现：需要更新的地方：
一：错误信息:增加属性存储错误信息

二：将可变的做成配置 使用属性来表示！

注意 后缀名和mime的关系：
	要求用户指定 后缀名，我们帮着推算出来mime：
	参考： 后缀名 与 MIME 映射关系！
	通过提供对照表：提示，实际中所有的类型最好都由对照！
</pre>

###目录操作
<pre>
创建
	Mkdir(目录地址, 权限, 是否递归创建)
	默认不支持递归创建：
	第三个参数写true：能够进行递归创建，防止只能创建一个文件夹，因为二三级文件夹的同时创建就是需要递归创建

	Tip：最近PHP增加的参数。

	第二个权限在windows被忽略！没用！
	在linux有用！

删除
	删除结果= Rmdir(目录地址)
	不允许删除非空目录！

获取目录内容
	句柄 = Opendir(目录地址);
	打开目录句柄。
	句柄：PHP程序与文件系统 数据流通道！

文件名 = Readdir(句柄);
	通过句柄，从目录中读取一个文件（包括文件和子目录），一次读取一个文件，并向下移动文件指针！
	注意，每个目录下都存在 ., .. 虚拟目录。表示 当前目录，和 上级目录。

	配合循环结构就可以获取目录内的全部内容：

	通常要 处理'.'和'..'
	
	文件名'0'的处理，因为0与false在模糊比较上是相同的，那么我们必须拿出精确相等来进行'0'文件名的处理

Closedir();
	关闭句柄

重命名（移动）
	函数：
	Rename(原始地址, 目标地址)
	针对文件和目录！
</pre>