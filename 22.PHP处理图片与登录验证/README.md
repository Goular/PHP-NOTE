#第二十二天笔记
###Cookie练习 – 记录登陆状态
<pre>
COOKIE中存储了可以认定当前浏览器处于登陆状态的信息才可以完成！
通常保证存储的信息具有以下特点：
可验证性。
保密性（安全性）。

通常可以采取，存储 加密处理 后的 管理员ID 和 密码 的组合！

具体查看mvc-demo21
</pre>


###绘图技术(应用场景:验证码)
<pre>
作用？
防治计算机程序，向服务器发出请求从而达到恶意的目的：
例如：

登陆界面：暴力破解！
论坛：灌水，刷帖！
被采集：

特点，快！

提升 计算机请求的成本（时间，准确率）。
计算机技术不能成本很低从 图片上识别信息！

使用 表单中 增加验证码的方式，方式 计算机恶意请求服务器！

实现技术：
	生成图片技术！
	验证时：将码值存储与session中！
</pre>

###加载扩展
<pre>
必须打开php.ini的拓展:
	extension=php_gd2.dll
</pre>

###创建画布资源
<pre>
创建新的画布：
	画布资源 = Imagecreate(宽，高);创建基于调色板画布（支持的颜色少）
	画布资源 = Imagecreatetruecolor(宽，高);创建正彩色（支持的颜色多）
	
基于已有图像创建画布：
	画布资源 =  Imagecreatefromjpeg(图片地址);
	Imagecreatefrompng();
	Imagecreatefromgif();


操作画布
分配颜色:为某张画布分配某种颜色。
颜色的表示方式：RGB颜色。
	颜色标识 = Imagecolorallocate(画布，颜色R， 颜色G， 颜色B)

#ff0000 红色
#000000 黑
#ffffff   白

填充画布：使用某个颜色，在画布的某个位置进行填充
	Imagefill(画布，位置X，位置Y，颜色);
位置，采用坐标表示。
原点：左上角，0, 0
向右，X 增加
向下，Y 增加
右下角坐标：（width-1, height-1）

导出（输出）
是函数：
Imagepng(画布， 图片地址)	输出为PNG格式
Imagegif();
Imagejpeg()
完成

销毁资源
imagedestroy($image);
</pre>

###仿照ecshop完成验证码
<pre>
特征：

点击更换
图片背景更换（在有限几张背景图片中选择背景）
码值：大写字母+数字 随机组合！4个长度
文字颜色：白色或者黑色
文字，居中显示
</pre>


###产生验证码步骤
<pre>
1.处理码值
2.存储在session中
3.形成验证码图片
	获取需要的背景图片：
	拷贝项目中：
	获得随机背景图片：
	创建画布：
	
4.操作画布：
	分配字符串颜色：
	Imagecoloarallocate(画布，R, G, B);
5.将字符串写到画布上！
	Imagestring(画布，字体大小，位置X, 位置Y，字符串内容，颜色);
字体大小：该函数使用内置字体。通过1-5表示字号。1小5大。
位置坐标，字符串左上角的坐标！
6.输出导出：

7.补充文件居中
图片宽高：
	宽 = Imagesx(画布);
	高 = Imagesy(画布);
内置字体的宽高：
	imagefontWidth(字体);
	imagefontHeight(字体);
字符串宽高：
</pre>

###项目中使用验证码
<pre>
考虑到验证码功能，不仅一个项目一个功能要用，几乎所有的项目都要使用！
将验证码处理的代码，放置 项目框架目录中framework！


定义 验证码相关功能 的 工具类（扩展功能类）。
工具类：专门用于完成某一个功能类封装！

</pre>

###点击更换验证码
<pre>
在点击图片时，重写请求生成验证码的动作。

语法实现：
Onclick：事件
执行更改当前图片img元素的src属性，此时浏览器就会发出新的请求。
</pre>


###文件上传
<pre>
上传：	文件从浏览器端传输到服务器端。
浏览器与服务器的交互存在几种方式：请求，响应！
数据由浏览器端传输到服务器端，发生在哪个阶段？ 请求阶段。

结论：文件上传是发生在请求阶段。

请求是浏览器发出的，浏览器将请求数据传输到服务器端。因此，文件也是由浏览器上传到服务器端！

</pre>

###当浏览器需要上传文件时
<pre>
表单中的数据类型共两种：字符串型和文件型。
但是：默认情况下，两类会将所有的表单元素，视为 字符串型！

如果需要上传文件，告知浏览器，表单中的数据存在多种类型（字符串和文件型）：通过在form元素中增加属性：
Enctype=’multipart/form-data”
编码类型 = 多部分/表单-数据


当服务器脚本PHP，接收到文件类型的post数据如何处理？
将接收到的文件，存储在 上传临时目录中。默认为 服务器所在操作系统的临时目录。

该临时文件有效期为脚本周期！（时间短）
可以使用sleep（10）延长测试的时间，这样可以看清楚上传文件的有效期是脚本的时间

</pre>


###为了在脚本周期内处理好文件，那么我们需要做一下工作
<pre>
在临时文件未消失前，将其持久性存储！
通过函数：移动已经上传的参数
Move_uploaded_file(临时文件地址，目标文件地址);
通过 预定义变量$_FILES获得所有的上传文件的信息。
</pre>

###$_FILE
<pre>

第一个参数：name :原始文件名
第二个参数:type:类型
第三个参数:tmp_name :临时文件地址
第四个参数:error:是否在上传的时候存在错误
第五个参数:size:文件的大小


</pre>




