# Linux学习笔记Day02

### 内容回顾
<pre>
	1.系统常用指令
		ls  cd   pwd    whoami   su   init 3/5
	2.分区原理
		挂载：操作系统目录 与 硬盘分区 联系的过程
		挂载点： 与硬盘分区联系的目录就是挂载点
		win系统：C/D/E/G/H/K/I/J等都是挂载点
		linux系统：普通目录
		挂载类型：自动、手动
		根目录：win系统有多个、Linux系统有一个(/斜杠)
		文件占据磁盘分区空间：
		win系统：文件占据自己盘符对应分区空间
		Linux系统：文件会占据其上边与其挨着最近挂载点对应的分区空间
		Linux系统目录与新硬盘符挂载(联系)：
		目录就的文件释放出去、再与新硬盘挂载
	3.根目录介绍
		/dev    /home   /etc    /usr    /var
	4.目录相关操作
		创建：mkdir  -p  newdir/newdir/newdir
		移动改名字（文件/目录）： mv  filea  dira/newfile
		复制改名字（文件/目录）：cp -r  file  dir
		删除（文件/目录）： rm -rf file
	5.文件简单操作
		查看：cat   more    less    head -n    tail -n   wc
		创建文件：touch  filename
		追加内容：
			echo  内容  >/>>  filename
			cat  filea  >/>>  fileb
			ls  目录  >/>>  file
	6.用户和组操作
		用户操作：
			增加：useradd  -g gid  -u uid  -d 家目录  用户名
			修改：usermod  -g gid  -u uid  -d 家目录 -l newname   用户名
			删除：userdel  -r  用户名
		组别操作：
			增加：groupadd  组名
			修改：groupmod  -g gid  -n newname  组名
			删除：groupdel  组名
	7.给用户设置密码(登录系统)
			># passwd 用户名
			>#两次密码
</pre>

### Vi/Vim 编辑器(Linux记事本)
<pre>
	Linux常用的是以下的两种:
		vim:编辑器中的神
		Emacs:神的编辑器
	
	1.三种模式
		(1)命令模式 (命令模式[a/i/o/s]->编辑模式 , 命令模式[":"或者"/"]->尾行模式) 
				a: 光标后移动一位
				i: 光驱和所在内容没有任何变化
				o: 另起一个新行
				s: 删除光标所在的一个字符
				
				[1]光标移动
					a.字符级移动
						上(k) 下(j) 左(h) 右(l)键
					b.单词级
						w  word下个单词首字母
						b  before上个(本)单词首字母
						e  end下个(本)单词尾字母
					c. 行级
						0  行首
						$  行尾
					d. 段落级(内容之间有空白行)
						{   上个(本)段落首部
						}   下个(本)段落尾部
					e. 屏幕级(不翻屏)
						H   屏幕首部
						L   屏幕尾部
					f. 文档级
						G   文档尾行
						1G  文档首行
						nG  文档第n行
    
				[2] 删除内容
					dd      删除光标当前行
					ndd     从光标当前行向后删除n行内容
					x       删除光标所在的字符
					cw      从光标所在位置删除至单词结尾，并进入“编辑”模式
							(该方式方便删除“单个单词”)

				[3] 复制内容
					yy      复制光标当前行
					nyy     从光标当前行向后复制n行内容
					p       对复制(删除)好的内容进行粘贴操作

				[4] 快捷操作
					u       undo撤销
					r       替换单个字符
					J       合并上下两行
					.点     重复执行上个指令
				
		(2)编辑模式 (编辑模式 [ESC]->命令模式(默认))
		(3)尾行模式 (尾行模式[ESC/连续两次ESC/删除全部尾行内容]->命令模式)
				普通操作:
				:w 保存文档
				:q 退出vim编辑器
				:wq 保存并退出
				
				对文档没有操作权限，可以强制执行，即权限为 x
				:w!     强制保存
				:q!     强制退出(不保存修改，直接强制退出)
				:wq!    强制保存并退出(不同的用户，没有权限读，但有权限写操作的时候，可以直接用wq!,覆盖原来内容并保存)
				
				:set  number 或 set nu          给编辑器设置行号
				:set  nonumber 或 set nonu      取消行号设置

				:数字              光标跳转到数字所在行
				
	
	文件被非法关闭会形成备份文件，先删除该备份文件(否则该文件禁止修改)，再做具体操作
		具体的备份文件是一个隐藏的文件，需要使用ls -al才能看到，可以使用rm -rf filename删除
</pre>

### 权限操作
<pre>
	权限：用户针对文件是否拥有 读、写、执行 的权利。

	权限本身划分为：读Read、写Write、执行eXecute
	权限针对用户的划分：主人User、同组用户Group、其他组用户Other
	
	例子: d rwx rwx rwx   
		第一位是是否是文件夹
		二到四位:创建用户的权限
		五到七位:用户组权限
		八到十位:其他用户的权限
	-------------------------------------------------------------------------------------------------------
		1.权限的设置
			(1)字母相对方式权限的设置：
				权限只是针对局部有发生影响
				chmod u+/-rwx ,g+/-rwx ,o+/-rwx  文件
				
				组别：ugo可以设置多个或一个
				权限：rwx 可以设置一个或多个
				增减权限： + - 号 在每个组别里边只能用一次
				
				> chmod  u+rw  filename         //给文件主人增加 读、写 权限
				> chmod  u+x,g-rx  filename     //主人增加执行，同组用户去除 读、执行 权限
				> chmod  u+r,u-x  filename      //主人增加 读 权限、去除 执行 权限
			(2)数字绝对方式权限设置(及与字母方式的取舍)
				权限发生影响的范文是“全部”
				4:Read读    2:Write写    1:eXecute执行
				具体权限：
				0->没有任何权限
				1->执行
				2->写
				3->写、执行
				4->读
				5->读、执行
				6->读、写
				7->读、写、执行

				chmod  ABC  filename    //ABC分别代表主人、同组、其他组用户权限数字信息
				> chmod 753  filename   //主人：读、写、执行
										  同组：读、执行
										  其他组：写、执行
				
				>chmod -R 765   dir      //通过“递归”方式设置目录的权限
		
		字母与数字方式的取舍：
			① 文件权限修改较少使用“字母方式”
			② 文件权限修改较多使用“数字方式”,因为三个数字就能控制三组的权限控制内容	
			
		2. 使用权限
			2.1 文件对权限的使用
				读：是否可以查看文件内容
				写：是否可以修改该文件(可以强制写操作)
				执行：① 二进制文件  ② 批量指令执行文件(windows批处理文件/linux shell脚本文件)
			linux系统里边可以编写shell脚本程序文件，该文件执行过程中可以批量执行指令。(shell文件类似windows系统的批处理程序bat文件)
			shell脚本程序文件在linux系统可以批量执行指令。
		
			2.2 目录对权限的使用
				读：是否可以查看该目录内部的文件信息
				写：是否可以给该目录创建、删除文件
				执行：指定用户是否可以cd进入该目录	
	
		3. 权限针对文件强制操作
			对文件没有r或w写权限，还要修改该文件，可以!感叹号强制写保存。
			A 对文件没有w写权限，可以强制写保存
			B 对文件有w写权限、没有r读权限，强制写保存，新写入内容会覆盖文件原内容。
			C 非主人(同组/其他组)用户，没有w写权限，强行写保存(或许成功、或许不成功)
				
				强制保存成功和不成功，归结于上级目录是否允许其他人是否可以修改，这一点直接影响强制保存是否会成功
			
				重点:(①该文件的上级目录针对该修改者没有开放w写权限，强行写保存不成功)   
				重点:(②该文件的上级目录针对该修改者有开放w写权限，强行写保存成功)
				强制修改成功后，文件的主人、组别变为修改者的主人、组别。
		
		小总结:
			1.vi编辑器
				三种模式：命名、尾行、编辑
				尾行模式操作： 
				:w  :q  :wq   :w!   :q!    :wq!
				:数字      :set nu   :set nonu
				:/(查找的内容)  	查找
				:s/con1/cont2/      替换当前行最近的一个
				:s/con1/cont2/g		替换当前行全部满足条件的内容
				:%s/con1/cont2/g    替换全文全部满足条件的内容
				
				注意:%为全文内容
				
				命名模式
				移动：字符级(上下左右键)、单词级（bwe）、行级（0/$）、段落级({})、屏幕级(H/L)、文档级(nG)
				删除：dd   ndd    x    cw
				复制：yy   nyy   p
			2.权限
				字母方式：chmod  u+/-rwx,g+/-rwx,o+/-rwx  filename
				数字方式：chmod  ABC  filename
</pre>

### 系统常用指令
<pre>
	    grep  内容   文件       		//在文件中搜寻指定“内容”，会把“内容”所在行的信息都打印到终端
			> grep itcast passwd    	//在passwd文件中搜寻itcast内容,根据搜索内容对文件进行搜索，并打印出来
		
		查找指令对应的执行程序文件		//
			> which 指令		
			
		查看文件/目录占据磁盘空间大小
			硬盘空间被格式化为小格子，每个小格子默认大小为4k（4096个字节）
			文件大小如果不足4k，则分配一个格子大小进行存储
			如果文件大小超过格子，则分配大于文件大小的整数倍的格子空间
			> du  -h   文件	
			
		查看系统分区的情况
			>df -lh

</pre>

### 管道pipe
<pre>
	变量修饰器/管道：前者的输出是后者的输入参数。(与sql的子查询作为数据源很相像)

	linux的管道与smarty的变量修饰器使用效果一致。
	输出的信息与预期信息不符合，需要通过中间介质(其他函数)对信息再进一步处理、过滤优化。

	Smarty的变量修饰器：
	{$time | date_format:“%Y-%m-%d %H:%M:%S“}   //date()
	{$title | upper}    //strtoupper()
	{$content|upper|lower|XXX|YYY}  可以同时使用多个修饰器。

	linux的管道：
	其中的许多指令(grep  head  tail  wc  ls等等)都可以当做管道符号使用.
	> ls  -l  | wc      				//计算当前目录一共有多少个文件
	> grep  sbin  passwd  |  wc    	//计算passwd文件中出现sbin内容的行数
	> ls  -l  |  head  -10    		//以详细列表形式查看当前目录下前10个文件
	> ls  |  grep  apple   			//在当前目录下查找出现“apple”字样的文件名字
	> ls  -l  |  head  -20 | tail -5    //查看当前目录中第16-20个文件信息
</pre>

### 文件查找 find
<pre>
	查找文件或者目录
	
	find 目标目录 参数选项 选项值
	参数选项:
	-group 
	-gid
	-user 
	-uid
	-type   (f/d 文件/目录) directory
	-name
	-size	默认单位是:块(512字节) ,还有其他的单位:c ：字节 ,k : 千字节
	-perm   按文件权限模式来查找文件,find . -perm 755 -printde
	-maxdepth -mindepth
	
	    find   查找目录   选项  选项值 选项 选项值....
    > find  /  -name  passwd   //在/斜杠 根目录下查找文件名称为passwd的文件
                                //该指令效率低，其要在"递归遍历"系统全部目录进行文件查找
    选项：
        -name    根据文件名称查找文件
            通过“完整”文件名称进行查找
            > find  ./  -name  order.txt   //在当前目录下查找文件名称等于'order.txt'的文件
                                            //需要递归遍历当前目录下的所有“子级目录”
            根据"模糊"名称查找文件，不确定名称使用"*"号代表
            > find  ./  -name  "guang*"     //在当前目录下查找名称以"guang"为开始的文件
        
        -maxdepth  限制查找文件的最深目录层次
            > find  /   -maxdepth  4 -name passwd  //在小于等于4个目录层次之间寻找passwd文件 ,这个-name，和-maxdepth最好是设定好层数再去寻找，不然就会寻找到所有的符合
        -mindepth  限制查找文件的最浅目录层次
            > find  /  -mindepth 3  -maxdepth 4 -name passwd //在3到4个目录层次之间寻找passwd文件

        -size   根据文件大小查找
            > find  ./  -size  -100c  //在当前目录下查找大小【小于】100个字节的文件
            > find  ./  -size   26c   //在当前目录下查找大小【等于】26个字节的文件
            > find  ./  -size  +26c   //在当前目录下查找大小【大于】26个字节的文件
            单位：
                100-----> 512字节 == 100*512字节
                100c----> 字节    == 100字节
                100k----> 千字节  == 100*1024字节
                100M----> 兆      == 100*1024*1024字节
</pre>

### Linux文件管理系统
<pre>
	文件(索引号)-->分区管理-->依据索引号-->找到文件的实体内容
	rm 文件 ，仅仅是删除文件的硬链接，Linux会定时遍历GC，这样才会去删除真正的实体内容
	所以可以存在很多的硬链接，当实体文件的链接计数器为0的时候，才算真正的删除文件，所以硬链接可以多个。
</pre>


### 软链接和硬链接
<pre>
	1. 软链接link
		定义：就是windows系统的快捷方式
		作用：可以对硬盘空间进行合理分配

		具体设置：
		>ln  -s   源文件    软链接
		源文件被删除，软链接就变为无效链接文件：
		
		1.1 软链接使用注意
			①设置软链接，源文件最好设置为绝对路径方式
			②普通文件和目录都可以设置软链接
			③源文件 被删除，对应的软链接就变为“无效链接”，如果再创建一个同名源文件，软链接又恢复为有效链接文件。
			
	2. 硬链接
		定义：系统里边文件的名称(引用)就是硬链接。
			给文件增加名称(引用)的过程就是创建“硬链接”过程
			(一个文件可以有多个名字，它们都是同一个文件实体的硬链接)
		
		> ln  [-d]  源文件   硬链接

		同一个文件实体如果有多个名称(引用)，即使其中一个名称被删除了，也不影响其他名称的使用(该文件实体依然存在)。
		如果一个文件实体只有一个名称，执行rm删除指令，只是删除文件名字而已。
		系统的垃圾回收机制会定期检查该文件是否存在名称(引用)，名称不存在就当垃圾给收走。

		新目录的硬链接数目为数字2，”本身”是一个，该目录内部的”.点目录”还是一个:	
		
		给一个目录下每增加一个目录，该目录的硬链接数目都会累加1:
		如下图，zhejiang的硬链接数目为3
		① 本身是一个
		② 本身内部的.点还是一个
		③ 本身目录下的hangzhou下的..点点还是一个
		
		
		2.1 硬链接使用注意：
			①设置硬链接的时候，源文件不需要使用绝对路径
			②只有普通文件可以设置硬链接，目录不可以
			③同一个源文件的所有硬链接文件必须 在同一个硬盘、同一个分区里边
				多个文件硬链接不能跨分区：
				
		2.2使用硬链接的好处：
			① 防止重要的文件被误删除
			② 如果有多人需要操作同一个文件(体积较大)，就给他们创建许多硬链接即可。
			(比较大的文件在服务器可以只存储一份，大家各自使用对应的硬链接即可)
		3. 软链接和硬链接异同
			不同点：
				软链接是快捷方式，可以用在硬盘空间合理分配上
				硬链接就是文件的名字，一个文件的许多名字就是不同的硬链接。
			相同点：
				大家都是针对同一个目标进行操作		
</pre>

### 任务调度指令设置
<pre>
	定义：规定系统在指定的时间完成指定的任务过程。
	设置：
		> crontab –e      //编辑任务调度指令
		> crontab –l      //查看任务调度指令
	
	crontab -e  设置任务调度指令
	#分钟	小时	日期	月份	星期	具体指令
	44	16	13	4	4	/home/goular/文档/task.txt	
	/home/goular/文档/task.txt 为shell脚本内容
	
	具体crontab -e的使用:
	#分钟	小时	日期	月份	星期几	执行命令
	43 21 * * * /home/filename			--每天的21:43分执行
	0 17 * * 1 /home/filename 			--每周一的17:00执行
	42 4 1 * * /home/filename			--每月1日4:42分执行
	0 21 * * 1-6 /home/filename			--每周一到周六 21:00执行
	2 8-20/3 * * * /home/filename	    --8:02,11:02,14:02,17:02,20:02执行，每三个小时执行一次
	30 5 1,15 * * /home/filename		--1日和15日的5:30执行 
	
</pre>

### 文件主人、组别设置
<pre>
	change owner
		>chown  主人  filename
		>chown  主人.组别  filename
		>chown  .组别   filename
		>chown -R 主人.组别  dir    //通过”递归”方式设置目录的属组信息
		>chmod -R 765   dir      //通过“递归”方式设置目录的权限
</pre>

### 总结
<pre>
	1.文件强制操作细节
	强制写操作失败情况：非主人用户针对文件及其上级目录都没有w写权限。
	2.系统常用指令
	grep    ps     date     du  -h       which
	3.管道
	前者的输出结果是后者的输入参数
	linux管道非常灵活：大部分指令都可以当做管道使用(grep  wc  head  tail  ls等等)
	4.文件查找
	-name: 完整、模糊文件名称查找
	-size：文件大小查找(+/-    单位：512字节  c   k   M)
	5.软链接和硬链接
	6.任务调度指令
	> crontab -e     (分钟   小时  日期  月份  星期   执行指令)
	7.主人和组别设置
	chown  主人.组别  filename
</pre>